---
title: "Itemã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®API Docã‹ã‚‰idãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã™ã‚‹"
---

# Itemã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®API Docã‹ã‚‰idãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã™ã‚‹

å‰ç« ã§ã€idãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãªã„Itemã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¾ã—ãŸãŒã€å½“è©²ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®API Docã‚’è¦‹ã‚‹ã¨ã€idãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒ **required** ã¨ã—ã¦å‡ºåŠ›ã•ã‚Œã¦ã„ã‚‹ã¾ã¾ã«ãªã£ã¦ã„ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/10da59a85764-20220506.png)

ã“ã“ã§ã‚‚ã€

* Item Getã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’API Docã‹ã‚‰ã‚‚å‰Šé™¤ã™ã‚‹
* Item Putã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®API Docã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã‚’å‰Šé™¤ã™ã‚‹
* Item Put/Item Patchã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®API Docã‹ã‚‰Linksã‚’å‰Šé™¤ã™ã‚‹

ã§è¡Œã£ãŸã®ã¨åŒæ§˜ã« `OpenApiFactory` ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ã€API Docã‹ã‚‰idãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

å…·ä½“çš„ã«ã¯ã€`App\ApiPlatform\OpenApiFactory` ã«ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§å¯¾å¿œå¯èƒ½ã§ã™ã€‚

```diff:src/ApiPlatform/OpenApiFactory.php
  class OpenApiFactory implements OpenApiFactoryInterface
  {
      public function __construct(private OpenApiFactoryInterface $decorated)
      {
      }

      public function __invoke(array $context = []): OpenApi
      {
          $openApi = $this->decorated->__invoke($context);

          /**
           * @var string   $path
           * @var PathItem $pathItem
           */
          foreach ($openApi->getPaths()->getPaths() as $path => $pathItem) {

              // ...
+
+             // remove id parameter in operations which include "#withoutIdentifier" in description from API Doc
+             foreach (PathItem::$methods as $method) {
+                 $getter = 'get'.ucfirst(strtolower($method));
+                 $setter = 'with'.ucfirst(strtolower($method));
+                 /** @var Operation|null $operation */
+                 $operation = $pathItem->$getter();
+                 if ($operation && preg_match('/#withoutIdentifier/', $operation->getDescription())) {
+                     /** @var Parameter[] $parameters */
+                     $parameters = $operation->getParameters();
+                     foreach ($parameters as $i => $parameter) {
+                         if (preg_match('/identifier/i', $parameter->getDescription())) {
+                             unset($parameters[$i]);
+                             break;
+                         }
+                     }
+                     $description = trim(strval(preg_replace('/#withoutIdentifier/', '', $operation->getDescription())));
+                     $openApi->getPaths()->addPath($path, $pathItem = $pathItem->$setter($operation->withDescription($description)->withParameters(array_values($parameters))));
+                 }
+             }
          }

          return $openApi;
      }
  }
```

ã“ã‚Œã§ã€ã€Œ`openapi_context` ã® `description` ã« `"#withoutIdentifier"` ã¨ã„ã†æ–‡å­—åˆ—ã‚’å«ã‚€ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦ã¯API Docã«idãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‡ºåŠ›ã—ãªã„ã€ã¨ã„ã†å‡¦ç†ã‚’ä»˜ã‘åŠ ãˆã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

> ã‚³ãƒ¼ãƒ‰ã®è©³ç´°ãªè§£èª¬ã¯ã“ã“ã§ã¯å‰²æ„›ã—ã¾ã™ã€‚ã‚„ã‚„é•·ã„ã§ã™ãŒã€ãã‚Œã»ã©é›£è§£ãªã‚³ãƒ¼ãƒ‰ã§ã¯ãªã„ã®ã§æ°—ã«ãªã‚‹æ–¹ã¯èª­ã¿è§£ã„ã¦ã¿ã¦ãã ã•ã„ã€‚

ã“ã‚Œã§æº–å‚™ãŒæ•´ã£ãŸã®ã§ã€æœ€å¾Œã« `Post` ã®Item Latest/Item PutLatestã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã« `openapi_context` ã‚’è¿½è¨˜ã—ã¦ã€`OpenApiFactory` ã®å‡¦ç†ã‚’é©ç”¨ã—ã¾ã—ã‚‡ã†ã€‚

```diff:config/packages/api_platform/Post.yaml
  App\Entity\Post:
    attributes:
      route_prefix: /v1

    itemOperations:
      latest:
        method: get
        path: /posts/latest
        controller: App\Controller\Post\ItemLatestController
        read: false
+       openapi_context:
+         description: 'Retrieves the latest Post resource. #withoutIdentifier'
      putLatest:
        method: put
        path: /posts/latest
        controller: App\Controller\Post\ItemPutLatestController
        read: false
+       openapi_context:
+         description: 'Replaces the latest Post resource. #withoutIdentifier'
      patch: ~
      delete: ~
```

ã“ã‚Œã§ã€ä¸‹å›³ã®ã¨ãŠã‚Š `GET /api/v1/posts/latest` `PUT /api/v1/posts/latest` ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®API Docã‹ã‚‰idãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®é …ç›®ã‚’å‰Šé™¤ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸğŸ‘

![](https://storage.googleapis.com/zenn-user-upload/fd6df93f1c48-20220506.png)
