---
title: "ã¨ã‚Šã‚ãˆãšå‹•ã‹ã—ã¦ã¿ã‚‹"
---

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ã¾ãšã¯ã€Symfonyã‚¢ãƒ—ãƒªã«API Platformã‚’å°å…¥ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```shell
$ composer create-project symfony/skeleton api-platform-example
$ cd api-platform-example
$ composer require orm
$ composer require --dev maker
```

ã²ã¨ã¾ãšã“ã‚“ãªæ„Ÿã˜ã§Symfonyã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¾ã™ã€‚

DBã¯ã€ä»Šå›ã¯SQLiteã‚’ä½¿ç”¨ã—ã¾ã™ã€‚`.env` ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¦ã€

```diff:.env
  ###> doctrine/doctrine-bundle ###
  # Format described at https://www.doctrine-project.org/projects/doctrine-dbal/en/latest/reference/configuration.html#connecting-  using-a-url
  # IMPORTANT: You MUST configure your server version, either here or in config/packages/doctrine.yaml
  #
- # DATABASE_URL="sqlite:///%kernel.project_dir%/var/data.db"
+ DATABASE_URL="sqlite:///%kernel.project_dir%/var/data.db"
  # DATABASE_URL="mysql://db_user:db_password@127.0.0.1:3306/db_name?serverVersion=5.7&charset=utf8mb4"
- DATABASE_URL="postgresql://symfony:ChangeMe@127.0.0.1:5432/app?serverVersion=13&charset=utf8"
+ # DATABASE_URL="postgresql://symfony:ChangeMe@127.0.0.1:5432/app?serverVersion=13&charset=utf8"
  ###< doctrine/doctrine-bundle ###
```

ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦DBã‚’ä½œæˆã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

```shell
$ bin/console doctrine:database:create
```

ã“ã‚Œã§ãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹Symfonyã‚¢ãƒ—ãƒªãŒä½œã‚ŒãŸã®ã§ã€

```shell
$ composer require api
```

ã§API Platformã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

ã“ã®æ™‚ç‚¹ã§ã€`symfony serve` ã—ã¦ http://localhost:8000/api ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€

![](https://storage.googleapis.com/zenn-user-upload/a865faee9557-20220505.png)

ã“ã®ã‚ˆã†ãªã€Swagger UIã§æ›¸ã‹ã‚ŒãŸAPI DocãŒè¡¨ç¤ºã•ã‚Œã¾ã™ğŸ‘ï¼ˆã‚‚ã¡ã‚ã‚“ã¾ã ä¸­èº«ã¯ç©ºã§ã™ãŒï¼‰

# ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ä½œã‚‹

ã§ã¯ç¶šã„ã¦ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ä½œã‚Šã¾ã—ã‚‡ã†ã€‚

ã“ã“ã§ã¯ã€ã‚ˆãã‚ã‚‹ãƒ–ãƒ­ã‚°ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã«å€£ã£ã¦ `Post`ï¼ˆæŠ•ç¨¿ï¼‰ã¨ `Comment`ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆï¼‰ã¨ã„ã†2ã¤ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ä½œã£ã¦ã¿ã¾ã™ã€‚

```shell
$ bin/console make entity Post
# ç•¥

$ bin/console make entity Comment
# ç•¥
```

ã®ã‚ˆã†ã« `make` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ãˆã°ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨ãƒªãƒã‚¸ãƒˆãƒªã‚’ç°¡å˜ã«ä½œæˆã§ãã¾ã™ã€‚

ç­†è€…ã¯ãã‚Œã«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å‹å®£è¨€ã®è¿½è¨˜ã‚„ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨­å®šãªã©å°‘ã—ã ã‘æ‰‹ã‚’åŠ ãˆã¦ã€ã²ã¨ã¾ãšä»¥ä¸‹ã®ã‚ˆã†ãªå†…å®¹ã§ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ä½œæˆã—ã¾ã—ãŸã€‚

* [src/Entity/Post.php](https://github.com/ttskch/api-platform-example/blob/8b08fe3a943902a91a09abcc58bcb8a62fa5d9a5/src/Entity/Post.php)
* [src/Entity/Comment.php](https://github.com/ttskch/api-platform-example/blob/8b08fe3a943902a91a09abcc58bcb8a62fa5d9a5/src/Entity/Comment.php)

> ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ä½œæˆã—ãŸã‚Šã‚¹ã‚­ãƒ¼ãƒã‚’å¤‰æ›´ã—ãŸã‚Šã—ãŸã¨ãã¯ã€`bin/console doctrine:migrations:diff` ã§ [ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç”Ÿæˆ](https://github.com/ttskch/api-platform-example/blob/8b08fe3a943902a91a09abcc58bcb8a62fa5d9a5/migrations/Version20220505011357.php) ã—ã¦ `bin/console doctrine:migrations:migrate` ã§é©ç”¨ã™ã‚‹ã®ã‚’å¿˜ã‚Œãªã„ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚
> ä»¥é™ã¯ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦ã¯è¨€åŠã—ã¾ã›ã‚“ã®ã§ã”æ³¨æ„ãã ã•ã„ã€‚

# ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’APIãƒªã‚½ãƒ¼ã‚¹ã¨ã—ã¦å®£è¨€ã™ã‚‹

[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://api-platform.com/docs/distribution/#bringing-your-own-model) ã«ã‚ˆã‚‹ã¨ã€ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚¯ãƒ©ã‚¹ã« `#[ApiResource]` ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã‚’å®£è¨€ã™ã‚‹ã ã‘ã§ã€ãã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’APIãƒªã‚½ãƒ¼ã‚¹ã¨ã—ã¦å®£è¨€ã§ãã‚‹ãã†ã§ã™ã€‚ã‚„ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```diff
  <?php
  
  declare(strict_types=1);
  
  namespace App\Entity;
  
+ use ApiPlatform\Core\Annotation\ApiResource;
  use App\Repository\PostRepository;
  use Doctrine\Common\Collections\ArrayCollection;
  use Doctrine\Common\Collections\Collection;
  use Doctrine\ORM\Mapping as ORM;
  use Symfony\Component\Validator\Constraints as Assert;
  
  #[ORM\Entity(repositoryClass: PostRepository::class)]
+ #[ApiResource]
  class Post
  {
      // ...
  }
```

```diff
  <?php
  
  declare(strict_types=1);
  
  namespace App\Entity;
  
+ use ApiPlatform\Core\Annotation\ApiResource;
  use App\Repository\CommentRepository;
  use Doctrine\ORM\Mapping as ORM;
  use Symfony\Component\Validator\Constraints as Assert;
  
  #[ORM\Entity(repositoryClass: CommentRepository::class)]
+ #[ApiResource]
  class Comment
  {
      // ...
  }
```

ã“ã®çŠ¶æ…‹ã§ã€å†åº¦ http://localhost:8000/api ã‚’é–‹ã„ã¦ã¿ã‚‹ã¨ã€

![](https://storage.googleapis.com/zenn-user-upload/cbfa48b50a4f-20220505.png)

ã“ã®ã¨ãŠã‚Šã€`Post` ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨ `Comment` ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«ã¤ã„ã¦CRUDã®APIãŒä¸€é€šã‚Šå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ğŸ™Œ

# å‹•ã‹ã—ã¦ã¿ã‚‹

å®Ÿéš›ã«å‹•ã‹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

[Insomnia](https://insomnia.rest/) ç­‰ã®RESTã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¢ãƒ—ãƒªã§å®Ÿéš›ã« http://localhost:8000/api/posts ã«GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã£ã¦ã¿ã‚‹ã¨ã€ä¸‹å›³ã®ã‚ˆã†ã«ã€Œå…¨0ä»¶ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã€ã‚’è¡¨ã™ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ã£ã¦ãã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/dceda6026149-20220505.png)

ã§ã¯ç¶šã‘ã¦ `POST /api/posts` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½¿ã£ã¦æŠ•ç¨¿ã‚’æ–°è¦ä½œæˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

![](https://storage.googleapis.com/zenn-user-upload/21c52dd473d8-20220505.png)

ã“ã®ã‚ˆã†ã«æ­£å¸¸ã«ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

ã“ã®çŠ¶æ…‹ã§å†åº¦ `GET /api/posts` ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ã¨ã€

![](https://storage.googleapis.com/zenn-user-upload/8536b488c6fa-20220505.png)

ä»Šåº¦ã¯å…ˆã»ã©ã¨é•ã£ã¦ã€Œå…¨1ä»¶ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã€ãŒè¿”ã£ã¦ãã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

ã“ã®ã‚ˆã†ã«ã€åŸºæœ¬çš„ãªCRUDã ã‘ãªã‚‰ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã« `#[ApiResource]` ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã‚’å®£è¨€ã™ã‚‹ã ã‘ã§ä¸€ç¬ã§å‹•ã„ã¦ã—ã¾ã†ã®ãŒAPI Platformã®ã™ã”ã„ã¨ã“ã‚ã§ã™âœ¨

ã¡ãªã¿ã«ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å½¢å¼ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ [JSON-LD](https://json-ld.org/) + [Hydra](http://www.hydra-cg.com/) ã«ãªã£ã¦ã„ã¾ã™ã€‚
ã‚·ãƒ³ãƒ—ãƒ«ãª `application/json` ãªã©åˆ¥ã®ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¿ã‚¤ãƒ—ã«å¤‰æ›´ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

ã“ã®ç‚¹ã«ã¤ã„ã¦ã¯æœ¬æ›¸ã§ã¯è§£èª¬ã—ã¾ã›ã‚“ãŒã€ä»¥ä¸‹ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ååˆ†ã«è©³ã—ãèª¬æ˜ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€å¿…è¦ã«å¿œã˜ã¦å‚ç…§ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

[API Platform: Content Negotiation](https://api-platform.com/docs/core/content-negotiation/)
