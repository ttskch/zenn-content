---
title: "å®‰å…¨ãªãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒãƒ³ãƒ‰ã‚’ä½œæˆï¼ˆãªã©ï¼‰"
---

# ã“ã®ç« ã«å¯¾å¿œã™ã‚‹ã‚³ãƒŸãƒƒãƒˆ

* [ğŸ“ å®‰å…¨ãªãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒãƒ³ãƒ‰ã‚’ä½œæˆï¼ˆMySQLã®ä¾‹ï¼‰](https://github.com/ttskch/symfony-example-app/compare/893c2ed...47cf81b)
* [ğŸ“ Sentryã‚’å°å…¥](https://github.com/ttskch/symfony-example-app/commit/c3d921bed9d3cd6df8b5151d1a7b3e1a19fc4c24)

# å®‰å…¨ãªãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒãƒ³ãƒ‰ã‚’ä½œæˆï¼ˆãªã©ï¼‰

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ™ãƒ¼ã‚¹éƒ¨åˆ†ãŒã§ãã¦ããŸã¨ã“ã‚ã§ã€CI/CDã®è¨­å®šã«ç¶šã„ã¦æœ€åˆã®ã†ã¡ã«ã‚„ã£ã¦ãŠãã‚·ãƒªãƒ¼ã‚ºã§ã™ã€‚

## å®‰å…¨ãªãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒãƒ³ãƒ‰ã‚’ä½œæˆï¼ˆMySQLã®ä¾‹ï¼‰

1ã¤ã¯ã€ `doctrine:migrations:migrate` ã‚³ãƒãƒ³ãƒ‰ã‚’ãƒ©ãƒƒãƒ—ã—ãŸã‚³ãƒãƒ³ãƒ‰ã‚’ä½œã£ã¦ã€ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«ãã¡ã‚‰ã‚’ä½¿ã†ã‚ˆã†ã«ã™ã‚‹ã€ã¨ã„ã†ã‚‚ã®ã§ã™ã€‚

åƒ•ãŒæ™®æ®µé–‹ç™ºã™ã‚‹ç’°å¢ƒã§ã¯Blue Green Deploymentã®ã‚ˆã†ãªã‹ã£ã“ã„ã„ã‚¤ãƒ³ãƒ•ãƒ©ã¯åŸºæœ¬çš„ã«ãªã„ã®ã§ã€ã›ã‚ã¦ `doctrine:migrations:migrate` ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹å‰ã«å¿…ãš `mysqldump` ã‚’å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«ã—ã¦ä¸‡ãŒä¸€äº‹æ•…ãŒèµ·ã“ã£ãŸã¨ãã«ã™ãã«å¾©æ—§ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã‚ã‚Šã¾ã™ã€‚

è©³ç´°ã¯ä»¥ä¸‹ã®éå»è¨˜äº‹ã‚’ã”å‚ç…§ãã ã•ã„ã€‚

> [[Symfony] DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å‰ã«å¸¸ã«mysqldumpã‚’å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«ã—ã¦å¿ƒã®å¹³ç©ã‚²ãƒƒãƒˆã ãœï¼ | blog.ttskch](https://blog.ttskch.com/symfony-mysqldump-before-doctrine-migrations/)

ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè£…ã—ãŸã‚‰ã€ `deploy.php` ã«ä»¥ä¸‹ã®ã‚ˆã†ã«è¿½è¨˜ã—ã¦å¸¸ã«ã“ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```diff
  :
  :
+ task('app:database:migrate', function () {
+     run('{{bin/console}} app:database:migrate');
+ });
+ before('deploy:symlink', 'app:database:migrate');
  after('deploy:failed', 'deploy:unlock');
```

## Sentryã‚’å°å…¥

ã‚‚ã†1ã¤ã¯ã€[Sentry](https://sentry.io/) ã¨ã„ã†ç„¡æ–™ã®ã‚¨ãƒ©ãƒ¼ç›£è¦–ã‚µãƒ¼ãƒ“ã‚¹ã‚’å°å…¥ã—ã¦ãŠãã“ã¨ã§ã™ã€‚

ã¾ã ã‚¢ãƒ—ãƒªè‡ªä½“ã¯é››å½¢ã®çŠ¶æ…‹ã§ã™ãŒã€æœ¬ç•ªç’°å¢ƒã¸ã®CDã‚‚è¨­å®šã•ã‚Œã¦ã„ã¦ã“ã®æ™‚ç‚¹ã‹ã‚‰ãŠå®¢ã•ã‚“ã«ã¯å®Ÿéš›ã«è§¦ã£ã¦ã‚‚ã‚‰ã„ãªãŒã‚‰é–‹ç™ºã‚’é€²ã‚ã¦ã„ãã®ã§ã€æœ¬ç•ªç’°å¢ƒã§ç™ºç”Ÿã—ãŸã‚¨ãƒ©ãƒ¼ã¯ç›£è¦–ã—ã¦ãŠã‘ã‚‹ã¨ãƒã‚°ã‚’æ—©ã‚ã«æ½°ã›ã¦å¹¸ã›ã§ã™ã€‚

ã“ã¡ã‚‰ã‚‚è©³ç´°ã¯ä»¥ä¸‹ã®éå»è¨˜äº‹ã‚’ã”å‚ç…§ãã ã•ã„ã€‚

> [[è¶…ç°¡å˜] Symfonyãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«Sentryã‚’å°å…¥ã™ã‚‹ | blog.ttskch](https://blog.ttskch.com/symfony-sentry/)
