---
title: "BEAR.Sundayã§Parse.comã‚’ãƒ©ãƒƒãƒ—ã—ã¦APIã‚¢ãƒ—ãƒªã‚’ä½œã‚‹"
emoji: "ğŸ˜"
type: "tech"
topics: ["php", "bearsunday", "parsecom"]
published: true
published_at: 2014-12-23
---

:::message
ã“ã®è¨˜äº‹ã¯ã€2014-12-23ã«åˆ¥ã®ãƒ–ãƒ­ã‚°åª’ä½“ã«æŠ•ç¨¿ã—ãŸè¨˜äº‹ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã§ã™ã€‚
:::

# ã¯ã˜ã‚ã«

æœ€è¿‘ã€ä»¥ä¸‹ã®æ§‹æˆã§è¶£å‘³ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚’ä½œã‚ã†ã¨ã—ã¦ã„ã¾ã™ã€‚

* ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«ã¯ [Parse.com](https://parse.com/) ã‚’åˆ©ç”¨
* BEAR.Sunday ã‚¢ãƒ—ãƒªã§ Parse.com ã¨é€£æºã—ã¦å˜ç´”ãª CRUD ä»¥å¤–ã® API ã‚’å®Ÿè£…
* ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯ AngularJS

Parse.com ã¯ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã¨ REST API ã‚’æä¾›ã—ã¦ãã‚Œã‚‹ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆBaaSï¼‰ã§ã™ã€‚
æœˆ 100 ä¸‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆãã‚‰ã„ã¾ã§ç„¡æ–™ã‚‰ã—ã„ã®ã§ã€å°è¦æ¨¡ãªè¶£å‘³ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãªã‚‰ååˆ†ç„¡æ–™ã§ä½¿ãˆãã†ã§ã™ã€‚

ã“ã®è¨˜äº‹ã§ã¯ã€BEAR.Sunday ã‚¢ãƒ—ãƒªã§ Parse.com ã‚’ãƒ©ãƒƒãƒ—ã—ã¦ç‹¬è‡ªã® API ã‚’æä¾›ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

> Parse.com ã¯ [Cloud Code](https://parse.com/docs/cloud_code_guide) ã¨ã„ã†æ©Ÿèƒ½ã§ã‚µãƒ¼ãƒã‚µã‚¤ãƒ‰ã®å‡¦ç†ã‚’æ‹¡å¼µã§ãã‚‹ã‚‰ã—ã„ã®ã§ã€ãã‚Œã‚’ä½¿ãˆã° BEAR.Sunday ã‚¢ãƒ—ãƒªã‚’è‡ªåˆ†ã§ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹å¿…è¦ã¯ãªããªã‚Šãã†ã§ã™ãŒã€ä»Šå›ã¯ BEAR.Sunday ã®å‹‰å¼·ã‚‚å…¼ã­ã¦ã„ã‚‹ã®ã§ã“ã®ã‚ˆã†ãªæ§‹æˆã§ä½œã‚Šã¾ã™ã€‚

# Parse.com ã«ã‚¢ãƒ—ãƒªã‚’æº–å‚™

1. Parse.com ã« [ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—](https://parse.com/#signup)
2. [ã‚¢ãƒ—ãƒªã‚’ä½œæˆ](https://www.parse.com/apps/new)
3. Data Browser ã® `+ Add Class` ãƒœã‚¿ãƒ³ã‹ã‚‰ã¨ã‚Šã‚ãˆãš `User` ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
4. `Add a row` ãƒœã‚¿ãƒ³ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ 1 ã¤è¿½åŠ 

![](https://user-images.githubusercontent.com/4360663/73583913-26a20b00-44d8-11ea-8aaf-21631934bc26.png)

# BEAR.Sunday ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹

æ¬¡ã«ã€BEAR.Sunday ã‚¢ãƒ—ãƒªã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚composer ã§ç°¡å˜ã«ä½œæˆã§ãã¾ã™ã€‚

```bash
$ composer create-project bear/skeleton My.App
$ cd My.App
$ composer install
```

> ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã¯ `[ãƒ™ãƒ³ãƒ€å].[ã‚¢ãƒ—ãƒªå]` ã¨ä»˜ã‘ã‚‹ã¨åå‰ç©ºé–“ã¨ã‹ã‚’ã„ã„æ„Ÿã˜ã«ã—ã¦ãã‚Œã¾ã™ã€‚ã“ã“ã§ã¯ `My.App` ã¨ã„ã†ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã¾ã™ã€‚

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒä½œæˆã§ããŸã‚‰ã€`Users` ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚

```php
<?php
// src/Resource/App/Users.php

namespace My\App\Resource\App;

use BEAR\Resource\ResourceObject;

class Users extends ResourceObject
{
    public function onGet()
    {
        $this->body = 'test';

        return $this;
    }
}
```

ä»®ã«ã€ãŸã  `'test'` ã¨ã„ã†æ–‡å­—åˆ—ã‚’è¿”ã™ã ã‘ã® API ã¨ã—ã¾ã—ãŸã€‚
å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```bash
$ php bootstrap/contexts/api.php get "app://self/users"
200 OK
content-type: ["application\/hal+json; charset=UTF-8"]
cache-control: ["no-cache"]
date: ["Tue, 23 Dec 2014 10:13:28 GMT"]
[BODY]
test
```

å‹•ã„ã¦ã¾ã™ã­ã€‚

# Parse.com ã® PHP ç”¨ SDK ã‚’çµ„ã¿è¾¼ã‚€

PHP SDK ã«ã¯ã€Parse.com å…¬å¼ã® [parse/php-sdk](https://github.com/parseplatform/parse-php-sdk) ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```bash
$ composer require parse/php-sdk
```

SDK ã®åˆæœŸåŒ–ã«ã€Parse.com ã®

* Application ID
* REST API Key
* Master Key

ãŒå¿…è¦ã§ã™ã€‚ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã® [Settings] â†’ [Keys] ã§ç¢ºèªã—ã¦ãã ã•ã„ã€‚

## SDK åˆæœŸåŒ–

ã“ã® SDK ã®åˆæœŸåŒ–å‡¦ç†ã‚’ BEAR.Sunday ã®ã©ã“ã«æ›¸ãã¹ãã‹è¿·ã£ãŸã®ã§ã™ãŒã€`App` ã‚¯ãƒ©ã‚¹ã«åˆæœŸåŒ–ç”¨ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã—ã¦ `@PostConstruct` ã‚¢ãƒãƒ†ãƒ¼ãƒˆã™ã‚‹ã“ã¨ã§ã—ã£ãã‚Šãã‚‹æ„Ÿã˜ã«æ›¸ã‘ã¾ã—ãŸã€‚

https://twitter.com/ttskch/status/532864858648088579

https://twitter.com/BEARSunday/status/532884891843584000

```php
<?php
// src/App.php

namespace My\App;

use BEAR\Package\Provide\Application\AbstractApp;
use Parse\ParseClient;
use Ray\Di\Di\PostConstruct;

final class App extends AbstractApp
{
    /**
     * @PostConstruct
     */
    public function onInit()
    {
        $appId = 'Application ID';
        $restKey = 'REST API Key';
        $masterKey = 'Master Key';

        ParseClient::initialize($appId, $restKey, $masterKey);
    }
}
```

## Users ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒªã‚½ãƒ¼ã‚¹ã‚’ä¿®æ­£

Users ãƒªã‚½ãƒ¼ã‚¹ã‚’ä¿®æ­£ã—ã¦å®Ÿãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚

```php
<?php
// src/Resource/App/Users.php

namespace My\App\Resource\App;

use BEAR\Resource\Code;
use BEAR\Resource\ResourceObject;
use Parse\ParseException;
use Parse\ParseUser;

class Users extends ResourceObject
{
    public function onGet($objectId = null)
    {
        $query = ParseUser::query();

        if (!is_null($objectId)) {
            try {
                $query->get($objectId);
            } catch (ParseException $e) {
                $this['error'] = [
                    'code' => $e->getCode(),
                    'message' => $e->getMessage(),
                ];
                $this->code = Code::NOT_FOUND;

                return $this;
            }
        }

        $users = [];
        foreach ($query->find() as $user) {
            $users[] = json_decode($user->_encode(), true);
        }
        $this->body = $users;

        return $this;
    }
}
```

å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```sh
$ php bootstrap/contexts/api.php get "app://self/users"
200 OK
content-type: ["application\/hal+json; charset=UTF-8"]
cache-control: ["no-cache"]
date: ["Tue, 23 Dec 2014 11:12:10 GMT"]
[BODY]
0 => array(
  objectId TeDsTS7UxB,
  createdAt => array(
    date 2014-12-23 10:04:40,
    timezone_type 2,
    timezone Z,
  ),
  updatedAt => array(
    date 2014-12-23 10:04:45,
    timezone_type 2,
    timezone Z,
  ),
  username test,
),

[VIEW]
{
    "0": {
        "objectId": "TeDsTS7UxB",
        "createdAt": {
            "date": "2014-12-23 10:04:40",
            "timezone_type": 2,
            "timezone": "Z"
        },
        "updatedAt": {
            "date": "2014-12-23 10:04:45",
            "timezone_type": 2,
            "timezone": "Z"
        },
        "username": "test"
    },
    "_links": {
        "self": {
            "href": "http://localhost/app/users/"
        }
    }
}

```

ã¡ã‚ƒã‚“ã¨å–å¾—ã§ãã¾ã—ãŸï¼

## ãƒ¦ãƒ¼ã‚¶ã®ä½œæˆã‚‚å‡ºæ¥ã‚‹ã‚ˆã†ã«ã™ã‚‹

`Users` ãƒªã‚½ãƒ¼ã‚¹ã« `onPost()` ã‚’è¿½åŠ ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ã®ä½œæˆã‚‚å‡ºæ¥ã‚‹ã‚ˆã†ã«ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```php
    public function onPost($username, $password, $email)
    {
        $user = new ParseUser();
        $user->set('username', $username);
        $user->set('password', $password);
        $user->set('email', $email);

        try {
            $user->signUp();
            $this->body = json_decode($user->_encode(), true);

        } catch (ParseException $e) {
            $this['error'] = [
                'code' => $e->getCode(),
                'message' => $e->getMessage(),
            ];
            $this->code = Code::BAD_REQUEST;
        }

        return $this;
    }
```

ä½œæˆã—ã¦ã¿ã‚‹ã€‚

```sh
$ php bootstrap/contexts/api.php post "app://self/users?username=name&password=pass&email=user@test.com"
200 OK
content-type: ["application\/hal+json; charset=UTF-8"]
cache-control: ["no-cache"]
date: ["Tue, 23 Dec 2014 11:23:56 GMT"]
[BODY]
objectId NhOZYYKoBC,
createdAt => array(
  date 2014-12-23 11:23:56,
  timezone_type 2,
  timezone Z,
),
updatedAt => array(
  date 2014-12-23 11:23:56,
  timezone_type 2,
  timezone Z,
),
username name,
email user@test.com,

[VIEW]
{
    "objectId": "NhOZYYKoBC",
    "createdAt": {
        "date": "2014-12-23 11:23:56",
        "timezone_type": 2,
        "timezone": "Z"
    },
    "updatedAt": {
        "date": "2014-12-23 11:23:56",
        "timezone_type": 2,
        "timezone": "Z"
    },
    "username": "name",
    "email": "user@test.com",
    "_links": {
        "self": {
            "href": "http://localhost/app/users/?username=name&password=pass&email=user%40test.com"
        }
    }
}

```

å†åº¦å–å¾—ã—ã¦ã¿ã‚‹ã€‚

```sh
$ php bootstrap/contexts/api.php get "app://self/users"
200 OK
content-type: ["application\/hal+json; charset=UTF-8"]
cache-control: ["no-cache"]
date: ["Tue, 23 Dec 2014 11:25:41 GMT"]
[BODY]
0 => array(
  objectId TeDsTS7UxB,
  createdAt => array(
    date 2014-12-23 10:04:40,
    timezone_type 2,
    timezone Z,
  ),
  updatedAt => array(
    date 2014-12-23 10:04:45,
    timezone_type 2,
    timezone Z,
  ),
  username test,
),
1 => array(
  objectId NhOZYYKoBC,
  createdAt => array(
    date 2014-12-23 11:23:56,
    timezone_type 2,
    timezone Z,
  ),
  updatedAt => array(
    date 2014-12-23 11:23:56,
    timezone_type 2,
    timezone Z,
  ),
  email user@test.com,
  username name,
),

[VIEW]
{
    "0": {
        "objectId": "TeDsTS7UxB",
        "createdAt": {
            "date": "2014-12-23 10:04:40",
            "timezone_type": 2,
            "timezone": "Z"
        },
        "updatedAt": {
            "date": "2014-12-23 10:04:45",
            "timezone_type": 2,
            "timezone": "Z"
        },
        "username": "test"
    },
    "1": {
        "objectId": "NhOZYYKoBC",
        "createdAt": {
            "date": "2014-12-23 11:23:56",
            "timezone_type": 2,
            "timezone": "Z"
        },
        "updatedAt": {
            "date": "2014-12-23 11:23:56",
            "timezone_type": 2,
            "timezone": "Z"
        },
        "email": "user@test.com",
        "username": "name"
    },
    "_links": {
        "self": {
            "href": "http://localhost/app/users/"
        }
    }
}

```

ã¡ã‚ƒã‚“ã¨ä½œæˆã•ã‚Œã¦ã¾ã™ã­ï¼

ä¸€å¿œãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã‚‚ç¢ºèªã€‚ãƒ¦ãƒ¼ã‚¶ãŒã¡ã‚ƒã‚“ã¨å¢—ãˆã¦ã¾ã™ã€‚

![](https://user-images.githubusercontent.com/4360663/73583954-53562280-44d8-11ea-89ec-41c6ed32ca14.png)

# ã¾ã¨ã‚

ã“ã“ã¾ã§å‡ºæ¥ãŸã‚‰ã‚ã¨ã¯ BEAR.Sunday å´ã§ Parse.com ã®ãƒ‡ãƒ¼ã‚¿ã‚’åŠ å·¥ã—ã¦è¿”ã—ã¦ãã‚Œã‚‹ API ã¨ã‹ã€é–¢é€£ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ‹¬ã§å¤‰æ›´ã™ã‚‹ API ã¨ã‹ã€ã„ã‚ã„ã‚ç°¡å˜ã«ä½œã‚Œãã†ã§ã™ã­ï¼

BaaS ãŒæä¾›ã—ã¦ãã‚Œã‚‹ API ã§ã¯åŸºæœ¬çš„ãª CRUD ã—ã‹ã§ããªã„ã®ã§ã€åŸºæœ¬çš„ãªå‡¦ç†ã‚’ BEAR.Sunday å´ã§å®Ÿè£…ã—ã¦ãŠã‘ã°ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã¯ã»ã¼ãƒ“ãƒ¥ãƒ¼ã‚’ç”¨æ„ã™ã‚‹ã ã‘ã§è‰¯ããªã‚‹ã‚“ã˜ã‚ƒãªã„ã‹ã¨ç”»ç­–ã—ã¦ã„ã¾ã™ã€‚ï¼ˆè¤‡æ•°ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¢ãƒ—ãƒªã‚’ç°¡å˜ã«ä½œã‚Œã‚‹ï¼‰

BEAR.Sunday ã‚‚åˆå¿ƒè€…ã ã— Parse.com ã® SDK ã‚‚ã¾ã ä½¿ã„æ–¹ã‚’ã¡ã‚ƒã‚“ã¨ç†è§£ã§ãã¦ãªã„ã®ã§ã€ã“ã®è¨˜äº‹ã§ç´¹ä»‹ã—ãŸã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã¯å®Œæˆåº¦ãŒä½ã„ã¨æ€ã„ã¾ã™ãŒã€å°‘ã—ã§ã‚‚ãŠå½¹ã«ç«‹ã¦ã°å¹¸ã„ã§ã™ã€‚
