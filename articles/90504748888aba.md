---
title: "Flutterã§NNBDã‚’æœ‰åŠ¹åŒ–ã—ã¦ã‚‚é™çš„è§£æã¯ã§ãã‚‹ã‘ã©ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã¯ã§ããªã„ä»¶"
emoji: "ğŸ’»"
type: "tech"
topics: ["flutter"]
published: true
published_at: 2020-07-17
---

:::message
ã“ã®è¨˜äº‹ã¯ã€2020-07-17ã«åˆ¥ã®ãƒ–ãƒ­ã‚°åª’ä½“ã«æŠ•ç¨¿ã—ãŸè¨˜äº‹ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã§ã™ã€‚
:::

Flutterãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§Dartã®NNBDã‚’ã€Œæœ‰åŠ¹åŒ–ã€ã—ã‚ˆã†ã¨ã—ãŸã‚‰é™çš„è§£æã¯ã§ãã‚‹ã‘ã©ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã¯ã§ããªãã¦è‰²ã€…èª¿ã¹ãŸã®ã§å…±æœ‰ã—ã¾ã™ã€‚

# NNBDã¨ã¯

`NNBD` ã¨ã¯ã€ `Non-Nullable By Default` ã®ç•¥ã§ã€Dartã«ãŠã‘ã‚‹Nullå®‰å…¨ã®ãŸã‚ã®æ©Ÿèƒ½ã§ã™ã€‚

é€šå¸¸ãªã‚‰ `int i;` ã§å®£è¨€ã—ãŸ `i` ã«ã¯ `null` ã‚’ä»£å…¥ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ãŒã€NNBDã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ `null` ã‚’ä»£å…¥ã™ã‚‹ã“ã¨ãŒã§ããªããªã‚Šã¾ã™ã€‚Nullå¯å‹ã«ã™ã‚‹ã«ã¯ `int? i;` ã§å®£è¨€ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

> å‚è€ƒï¼š[Dartã®Nullå®‰å…¨å°å…¥çŠ¶æ³ (NNBD) - Qiita](https://qiita.com/Cat_sushi/items/44872ccc68604413f065)

# Dartå˜ä½“ã§NNBDã‚’ä½“é¨“ã—ã¦ã¿ã‚‹

ã¾ãšã¯Flutteré–¢ä¿‚ãªãDartå˜ä½“ã§ä½“é¨“ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

> FlutterãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ç’°å¢ƒãªã‚‰ã€ `flutter channel dev` ã§ [ãƒãƒ£ãƒ³ãƒãƒ«](https://github.com/flutter/flutter/wiki/Flutter-build-release-channels) ã‚’ `dev` ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã¨ `dart` ã‚³ãƒãƒ³ãƒ‰ãŒã‚°ãƒ­ãƒ¼ãƒãƒ«ã§ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚‹ã®ã§ã€ä¸€æ™‚çš„ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ã§æ¥½ã«æœ€æ–°ç‰ˆãŒå°å…¥ã§ãã¾ã™ã€‚

## 1. æº–å‚™

é©å½“ã«ã‹ã‚‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œã£ã¦ã€ãã®ä¸­ã«ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚Šã¾ã™ã€‚

```dart
// test.dart
void main() {
  int? i = null;
  print('test');
}
```

`int? i = null` ã¨ã„ã†NNBDã‚’å‰æã¨ã—ãŸã‚³ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã®ãŒãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚

## 2. é™çš„è§£æã—ã¦ã¿ã‚‹

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ `dart analyze` ã‚³ãƒãƒ³ãƒ‰ã§é™çš„è§£æã‚’è¡Œã£ã¦ã¿ã¾ã™ã€‚

```bash
$ dart analyze
Analyzing test...                      0.9s

  error â€¢ This requires the 'non-nullable' language feature to be enabled at test.dart:3:6 â€¢ (experiment_not_enabled)
   info â€¢ The value of the local variable 'i' isn't used at test.dart:3:8 â€¢ (unused_local_variable)

2 issues found.
```

`non-nullable` è¨€èªæ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã—ãªã„ã¨ä½¿ãˆãªã„è¨˜æ³•ï¼ˆ `int?` ï¼‰ãŒä½¿ã‚ã‚Œã¦ã¾ã™ã‚ˆã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã—ãŸã€‚

## 3. `analysis_options.yaml` ã‚’è¨­ç½®ã—ã¦é™çš„è§£æã—ã¦ã¿ã‚‹

æ¬¡ã«ã€åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä»¥ä¸‹ã®å†…å®¹ã§ [analysis_options.yaml](https://dart.dev/guides/language/analysis-options) ã‚’ä½œæˆã—ã¾ã™ã€‚

```yaml
analyzer:
  enable-experiment:
    - non-nullable
```

ã“ã®çŠ¶æ…‹ã§å†åº¦ `dart analyze` ã—ã¦ã¿ã‚‹ã¨â€¦

```bash
$ dart analyze
Analyzing test...                      1.0s

   info â€¢ The value of the local variable 'i' isn't used at test.dart:3:8 â€¢ (unused_local_variable)

1 issue found.
```

ã‚¨ãƒ©ãƒ¼ãŒæ¶ˆãˆã¾ã—ãŸã€‚

## 4. ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦ã¿ã‚‹

ã§ã¯æ¬¡ã«ã€ `dart test.dart` ã§å®Ÿéš›ã«ã‚³ãƒ¼ãƒ‰ã‚’ï¼ˆã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ï¼†ï¼‰å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚

```bash
$ dart test.dart
test.dart:3:6: Error: This requires the 'non-nullable' language feature to be enabled.
Try updating your pubspec.yaml to set the minimum SDK constraint to 2.9 or higher, and running 'pub get'.
  int? i = null;
     ^
```

é™çš„è§£æã§ã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã‹ã£ãŸã®ã«ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã—ãŸã€‚

## 5. `--enable-experiment=non-nullable` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã¦ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦ã¿ã‚‹

ä»Šåº¦ã¯ [`--enable-experiment=non-nullable`](https://dart.dev/tools/experiment-flags) ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã¦å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```bash
$ dart --enable-experiment=non-nullable test.dart
test
```

ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãŒæˆåŠŸã—ã¦æ­£å¸¸ã«å‹•ãã¾ã—ãŸã€‚

# Flutterãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§NNBDã‚’æœ‰åŠ¹åŒ–ã™ã‚‹æ–¹æ³•ï¼Ÿ

ã“ã“ã¾ã§ã§ã€Flutterã‹ã‚‰é›¢ã‚Œã¦Dartã®è¨€èªä»•æ§˜ã¨ã—ã¦ã®NNBDã®ä½¿ç”¨æ–¹æ³•ã«ã¤ã„ã¦ç†è§£ã§ããŸã¨æ€ã„ã¾ã™ã€‚

ã§ã¯ã€Flutterãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§NNBDã‚’æœ‰åŠ¹åŒ–ã—ãŸã„å ´åˆã©ã†ã™ã‚Œã°ã‚ˆã„ã‹ã‚’è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚

ã‚°ã‚°ã£ã¦ã¿ã‚‹ã¨ã€

* ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã« `analysis_options.yaml` ï¼ˆå†…å®¹ã¯â†‘ã®ã¨ãŠã‚Šï¼‰ã‚’è¨­ç½®ã™ã‚‹
* `pubspec.yaml` ã® `environment.sdk` ã‚’ `>=2.6.0 <3.0.0` ï¼ˆã¾ãŸã¯ãã‚Œä»¥ä¸Šï¼‰ã«ã™ã‚‹

ã¨ã„ã£ãŸæƒ…å ±ãŒãŸãã•ã‚“å‡ºã¦ãã¾ã™ã€‚

> * [Flutterã§NNBDã‚’æœ‰åŠ¹åŒ–ã™ã‚‹æ–¹æ³• - Qiita](https://qiita.com/ApplePedlar/items/1dcf34b95f28d71e0380)
> * [intellij idea - How can I enable Flutter/Dart language experiments? - Stack Overflow](https://stackoverflow.com/questions/55477046/how-can-i-enable-flutter-dart-language-experiments)

ãŒã€ã“ã‚Œã¯ `int?` ã®ã‚ˆã†ãª **NNBDå‰æã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã®æ–¹æ³•ã§ã¯ãªã„** ã®ã§æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚

å…ˆã«è¦‹ã¦ããŸã¨ãŠã‚Šã€ `analysis_options.yaml` ã¯ã‚ãã¾ã§é™çš„è§£æã®ãŸã‚ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚ã‚Šã€Dartã‚’ `non-nullable` æœ‰åŠ¹çŠ¶æ…‹ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã«ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ¸¡ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

å¿µã®ãŸã‚ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

## é™çš„è§£æã—ã¦ã¿ã‚‹

ã‚³ãƒ¼ãƒ‰ã®é©å½“ãªç®‡æ‰€ã« `int? i = null;` ã¨ã„ã†ä¸€æ–‡ã‚’å…¥ã‚Œã¦ã¿ã¾ã™ã€‚

ãã®ä¸Šã§ `flutter analyze` ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€

```bash
$ flutter analyze
Analyzing nnbd_sample...

  error â€¢ This requires the 'non-nullable' experiment to be enabled â€¢ lib/main.dart:11:8 â€¢ experiment_not_enabled
   info â€¢ The value of the local variable 'i' isn't used â€¢ lib/main.dart:11:10 â€¢ unused_local_variable

2 issues found. (ran in 6.4s)
```

è¦‹æ…£ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãŒå‡ºåŠ›ã•ã‚Œã¾ã—ãŸã€‚

## `analysis_options.yaml` ã‚’è¨­ç½®ã—ã¦é™çš„è§£æã—ã¦ã¿ã‚‹

ç¶šã„ã¦ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã« `analysis_options.yaml` ã‚’è¨­ç½®ã—ã¦ï¼ˆå¿µã®ãŸã‚ `flutter clean` ã—ã¦ï¼‰ã‹ã‚‰å†åº¦å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚

```bash
$ flutter analyze
Analyzing nnbd_sample...

   info â€¢ The value of the local variable 'i' isn't used â€¢ lib/main.dart:11:10 â€¢ unused_local_variable

1 issues found. (ran in 1.2s)
```

ã‚¨ãƒ©ãƒ¼ãŒæ¶ˆãˆã¾ã—ãŸã€‚

## ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦ã¿ã‚‹

æ¬¡ã«ã€ã“ã®çŠ¶æ…‹ã§ `flutter run` ã§ï¼ˆã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ï¼†ï¼‰å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚

```bash
$ flutter run
Launching lib/main.dart on iPhone SE (2nd generation) in debug mode...

Compiler message:
lib/main.dart:11:8: Error: This requires the 'non-nullable' experiment to be enabled.
Try enabling this experiment by adding it to the command line when compiling and running.
    int? i = null;
       ^
Running Xcode build...
Xcode build done.                                            9.4s
Failed to build iOS app
Error output from Xcode build:
â†³
    ** BUILD FAILED **


Xcode's output:
â†³

    Compiler message:
    lib/main.dart:11:8: Error: This requires the 'non-nullable' experiment to be enabled.
    Try enabling this experiment by adding it to the command line when compiling and running.
        int? i = null;
           ^
    Target kernel_snapshot failed: Exception: Errors during snapshot creation: null
    build failed.
    Command PhaseScriptExecution failed with a nonzero exit code
    note: Using new build system
    note: Building targets in parallel
    note: Planning build
    note: Constructing build description

Could not build the application for the simulator.
Error launching application on iPhone SE (2nd generation).
```

äºˆæƒ³ã©ãŠã‚Šã€Dartã® `non-nullable` ãŒæœ‰åŠ¹ã§ãªã„ãŸã‚ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã¯å¤±æ•—ã—ã¾ã—ãŸã€‚

# Flutterã§ `non-nullable` ã‚’æœ‰åŠ¹ã«ã—ã¦ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã“ã¨ã¯ã§ãã‚‹ã®ï¼Ÿ

ã‚°ã‚°ã¦ã¿ã‚‹ã¨ã€ã„ãã¤ã‹ã“ã®å•é¡Œã«ã¤ã„ã¦ã®è³ªå•ãŒè¦‹ã¤ã‹ã‚Šã¾ã™ã€‚

* [This requires the 'non-nullable' experiment to be enabled. Â· Issue #51846 Â· flutter/flutter](https://github.com/flutter/flutter/issues/51846)
* [dart - Non-nullable by default: how to enable the experiment? - Stack Overflow](https://stackoverflow.com/questions/57598838/non-nullable-by-default-how-to-enable-the-experiment)
* [Document how to run flutter commands with experiments Â· Issue #40490 Â· flutter/flutter](https://github.com/flutter/flutter/issues/40490)

ãŒã€ã€Œé™çš„è§£æã‚’æœ‰åŠ¹ã«ã™ã‚‹ã“ã¨ã€ã¨ã€Œ `non-nullable` ã‚’æœ‰åŠ¹ã«ã—ã¦ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã“ã¨ã€ã‚’æ··åŒã—ã¦ã„ã‚‹æ„Ÿã˜ã®ãƒ¬ã‚¹ãŒæ•£è¦‹ã•ã‚ŒãŸã‚Šã€Dartå˜ä½“ã§ `non-nullable` ã‚’æœ‰åŠ¹ã«ã™ã‚‹æ–¹æ³•ï¼ˆæœ¬è¨˜äº‹å†’é ­ã§èª¬æ˜ã—ãŸã‚‚ã®ï¼‰ã«ã—ã‹è¨€åŠã•ã‚Œã¦ã„ãªã‹ã£ãŸã‚Šã§ã€çµå±€Flutterã§ `non-nullable` ã‚’æœ‰åŠ¹ã«ã—ã¦ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã“ã¨ã¯ **ç¾çŠ¶ã¯ã§ããªã„** ã‚ˆã†ã ã¨ã„ã†ã®ãŒåƒ•ã®çµè«–ã§ã™ã€‚ï¼ˆã‚‚ã—æ–¹æ³•ã‚ã‚‹ãªã‚‰ãœã² [æ•™ãˆã¦](https://twitter.com/ttskch) ã„ãŸã ã‘ã‚‹ã¨å¬‰ã—ã„ã§ã™ğŸ™‡ï¼‰

ã‚‚ã—æœ‰åŠ¹ã«ã§ãã‚‹ã¨ã—ã¦ã‚‚ã€NNBDå‰æã§æ›¸ã‹ã‚Œã¦ã„ãªã„ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£è£½ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã‹ãŒã“ã¨ã”ã¨ãã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¡ã‚ƒã†ã¨æ€ã†ã®ã§ç¾çŠ¶ã¯ã¾ã å®Ÿè³ªä½¿ãˆã‚‹çŠ¶æ³ã˜ã‚ƒãªã„ã¨è€ƒãˆã¦ã‚ˆã„ã¨æ€ã„ã¾ã™ã€‚

`analysis_options.yaml` ã‚’è¨­ç½®ã—ã¦é™çš„è§£æã ã‘æœ‰åŠ¹ã«ã—ã¦ãŠã„ã¦ã€ `?` ã¨ã‹ã¯ä½¿ã‚ãšã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«å¯èƒ½ãªã‚³ãƒ¼ãƒ‰ã®ã¾ã¾ã§ãã‚‹ã ã‘Nullå®‰å…¨ãªã‚³ãƒ¼ãƒ‰ã‚’å¿ƒãŒã‘ã‚‹ã€ã¨ã„ã†ã®ãŒç¾çŠ¶ã®Flutterã§ã®NNBDã®ä½¿ã„æ–¹ã¨ã„ã†ã“ã¨ã§ã—ã‚‡ã†ã‹ã€‚

# ã¾ã¨ã‚

* `analysis_options.yaml` ã¯ãŸã ã®é™çš„è§£æã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãªã®ã§ã€ã“ã‚Œã‚’è¨­ç½®ã—ãŸã‹ã‚‰ã¨ã„ã£ã¦NNBDå‰æã®ã‚³ãƒ¼ãƒ‰ãŒã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã‚ã‘ã§ã¯ãªã„
* ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ã¯Dartã® `non-nullable` ã¨ã„ã†æ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
* Dartå˜ä½“ãªã‚‰ `dart --enable-experiment=non-nullable xxx.dart` ã¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ¸¡ã™ã“ã¨ã§ `non-nullable` ã‚’æœ‰åŠ¹ã«ã—ã¦ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã“ã¨ãŒã§ãã‚‹
* `flutter run` ã®è£å´ã§å®Ÿè¡Œã•ã‚Œã‚‹ `dart` ã‚³ãƒãƒ³ãƒ‰ã« `--enable-experiment=non-nullable` ã‚’æ¸¡ã™æ–¹æ³•ã¯ï¼ˆå¤šåˆ†ï¼‰ç¾çŠ¶ã¯å­˜åœ¨ã—ãªã„
* ç¾æ™‚ç‚¹ã§ã€ŒFlutterã§NNBDã‚’æœ‰åŠ¹ã«ã™ã‚‹ã€ã¨ã„ã†è¨€è‘‰ãŒæ„å‘³ã™ã‚‹ã®ã¯ã€å˜ã«NNBDã¨ã—ã¦ã®é™çš„è§£æã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ã„ã†æ„å‘³ã§ã‚ã‚Šã€NNBDå‰æã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã¨ã„ã†æ„å‘³ã§ã¯ãªã„
