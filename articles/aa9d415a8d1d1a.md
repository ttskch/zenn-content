---
title: "[Symfony] @IsGranted(\"ROLE_HOGE\")ã‚’POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã®ã¿é©ç”¨ã™ã‚‹æ–¹æ³•"
emoji: "ğŸ»"
type: "tech"
topics: ["php", "symfony"]
published: true
published_at: 2020-12-23
---

:::message
ã“ã®è¨˜äº‹ã¯ã€2020-12-23ã«åˆ¥ã®ãƒ–ãƒ­ã‚°åª’ä½“ã«æŠ•ç¨¿ã—ãŸè¨˜äº‹ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã§ã™ã€‚
:::

# ã¯ã˜ã‚ã«

[Symfony Advent Calendar 2020](https://qiita.com/advent-calendar/2020/symfony) ã®23æ—¥ç›®ã®è¨˜äº‹ã§ã™ï¼ğŸ„ğŸŒ™

æ˜¨æ—¥ã¯ [@polidog](https://twitter.com/polidog) ã•ã‚“ã® [ãã‚Œã§ã‚‚åƒ•ã¯@Templateã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ã„ãŸã„](https://polidog.jp/2020/12/22/symfony/) ã§ã—ãŸâœ¨

ä¸€æ˜¨æ—¥ã®åƒ•ã®è¨˜äº‹

> [[Symfony] @Templateã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ã‚ãªã„ã»ã†ãŒã„ã„ç†ç”± | blog.ttskch](https://blog.ttskch.com/symfony-template-annotation-is-deprecated/) 

ã«å¯¾ã™ã‚‹ã‚¢ãƒ³ã‚µãƒ¼ã‚¨ãƒ³ãƒˆãƒªãƒ¼çš„ãªå†…å®¹ã§å¬‰ã—ã‹ã£ãŸã§ã™ğŸ˜‚

åƒ•è‡ªèº«ã€`@Tempalte` ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã«èµ·å› ã—ã¦ç™ºç”Ÿã—ãŸãƒˆãƒ©ãƒ–ãƒ«ã®æ ¹æœ¬åŸå› ã‚’æ·±è¿½ã„ã™ã‚‹ç†±æ„ã¨æ°—åŠ›ãŒãªãã¦è©³ç´°ã‚’çŸ¥ã‚‹ã®ã‚’è«¦ã‚ã¦ãŸã¨ã“ã‚ã ã£ãŸã®ã§å¤§å¤‰ã‚ã‚ŠãŒãŸã„å†…å®¹ã§ã—ãŸï¼

> ã¡ãªã¿ã«ã€åƒ•ã¯ã‚ˆã [Twitterã«ã‚‚Symfonyãƒã‚¿ã‚’å‘Ÿã„ã¦ã„ã‚‹](https://twitter.com/search?q=from%3Attskch%20(symfony%20OR%20doctrine)&src=typed_query&f=live) ã®ã§ã€ã‚ˆã‚ã—ã‘ã‚Œã°ãœã² [ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ã‚„ã£ã¦ãã ã•ã„ğŸ•ŠğŸ¤²](https://twitter.com/ttskch)

# ã‚„ã‚ŠãŸã„ã“ã¨

ã•ã¦æœ¬é¡Œã§ã™ã€‚

`@IsGranted()` ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ãˆã°ã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã®å„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ROLEãƒ™ãƒ¼ã‚¹ã§ç°¡å˜ã«åˆ¶é™ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```php
/**
 * @Route("/foo/index", name="foo_index", methods={"GET", "POST"})
 * @IsGranted("ROLE_WRITE")
 */
public function index(Request $request)
{
    // ç•¥
}
```

ã“ã®ä¾‹ã§ã¯ã€ `foo_index` ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¨±å¯ã—ã¦ã„ã¾ã™ãŒã€ `ROLE_WRITE` ã‚’æŒãŸãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯GETã§ã‚‚POSTã§ã‚‚ã™ã¹ã¦å¼¾ã‹ã‚Œã¾ã™ã€‚

ã§ã¯ã€**GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯èª°ã§ã‚‚ã§ãã‚‹ã‘ã©ã€POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã ã‘ã¯ `ROLE_WRITE` ã‚’æŒã£ã¦ã„ãªã„ã¨ãƒ€ãƒ¡** ã¨ã„ã†ä»•æ§˜ã«ã—ãŸã„å ´åˆã¯ã©ã†ã™ã‚Œã°ã‚ˆã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ

ã“ã®è¨˜äº‹ã§ã¯ãã®ã‚„ã‚Šæ–¹ã‚’è§£èª¬ã—ã¾ã™ã€‚

> ã“ã¡ã‚‰ã®éå»è¨˜äº‹ã‚‚åˆã‚ã›ã¦ã©ã†ãã€‚
>
> [[Symfony] Security Voterã‚’ä½¿ã£ã¦ã€Œãƒªã‚½ãƒ¼ã‚¹ã®æ‰€æœ‰è€…ã§ãªã„ã¨ç·¨é›†ä¸å¯ã€ã‚’å®Ÿè£…ã—ã¦ã¿ã‚ˆã† | blog.ttskch](https://blog.ttskch.com/symfony-security-voter/)

# ã‚„ã‚Šæ–¹

ã¨ã„ã£ã¦ã‚‚ã‚„ã‚Šæ–¹ã¯ã¨ã¦ã‚‚ç°¡å˜ã§ã€ **`@IsGranted()` ã®ä»£ã‚ã‚Šã« [`@Security()`](https://symfony.com/doc/current/bundles/SensioFrameworkExtraBundle/annotations/security.html#security) ã‚’ä½¿ã†ã ã‘ã§ç°¡å˜ã«å®Ÿç¾ã§ãã¾ã™ğŸ‘

`@Security()` ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¯å¼•æ•°ã« [expression](https://symfony.com/doc/current/components/expression_language.html) ã‚’å–ã‚‹ã®ã§ã€`@IsGranted()` ã‚ˆã‚Šã‚‚è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã‚’æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚

 ã€ŒPOSTãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã®ã¿ `ROLE_WRITE` ã‚’è¦æ±‚ã™ã‚‹ã€ã¨ã„ã†ä»Šå›ã®ä¾‹ã§ã‚ã‚Œã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãªè¨˜è¿°ã§å®Ÿç¾ã§ãã¾ã™ã€‚

```php
/**
 * @Route("/foo/index", name="foo_index", methods={"GET", "POST"})
 * @Security("request.getMethod() === 'GET' or is_granted('ROLE_WRITE')")
 */
public function index(Request $request)
{
    // ç•¥
}
```

[symfony/expression-language](https://symfony.com/doc/current/components/expression_language.html) ã«ä¾å­˜ã—ã¦ã„ã‚‹æ©Ÿèƒ½ãªã®ã§ã€

```bash
$ composer require symfony/expression-language
```

ã—ã¦ãŠã‹ãªã„ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã®ã§ã”æ³¨æ„ãã ã•ã„ã€‚

![](https://tva1.sinaimg.cn/large/0081Kckwgy1glkyovajs8j31ms08ijrv.jpg)

> To use the @Security tag, you need to use the Security component 2.4 or newer and install the ExpressionLanguage component.

`expression` ã®æ›¸ãæ–¹ã®è©³ç´°ã«ã¤ã„ã¦ã¯ symfony/expression-language ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã”å‚ç…§ãã ã•ã„ã€‚

> * [The ExpressionLanguage Component (Symfony Docs)](https://symfony.com/doc/current/components/expression_language.html)
> * [The Expression Syntax (The ExpressionLanguage Component - Symfony Docs)](https://symfony.com/doc/current/components/expression_language/syntax.html)

ã¡ãªã¿ã«ã€ `@IsGranted()` ã®å ´åˆã‚‚åŒæ§˜ã§ã™ãŒã€æ¨©é™ãŒè¶³ã‚Šãªã‹ã£ãŸå ´åˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‹•ä½œã¯ã€Œ302ã§ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã€ãªã®ã§ã€403ã§ã‚¨ãƒ©ãƒ¼ã«ã—ãŸã„å ´åˆã¯å¼•æ•°ã§æ˜ç¤ºã—ã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™âœ‹

```php
/**
 * @Security("request.getMethod() === 'GET' or is_granted('ROLE_WRITE')", statusCode=403)
 */
```

# ãŠã‚ã‚Šã«

ã¨ã„ã†ã‚ã‘ã§ã€å°ãƒã‚¿ã§ã—ãŸãŒã€Symfonyã§ `@IsGranted("ROLE_HOGE")` ã‚’POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã®ã¿é©ç”¨ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦è§£èª¬ã—ã¦ã¿ã¾ã—ãŸã€‚ãŠå½¹ã«ç«‹ã¦ã°å¹¸ã„ã§ã™ã€‚

[Symfony Advent Calendar 2020](https://qiita.com/advent-calendar/2020/symfony)ã€æ˜æ—¥ã¯ [@77web](https://twitter.com/77web) ã•ã‚“ã§ã™ï¼ãŠæ¥½ã—ã¿ã«ï¼
