---
title: "symfony/consoleã‚’ä½¿ãˆã°CLIãƒ„ãƒ¼ãƒ«ãŒè¶…ç°¡å˜ã«ä½œã‚Œã‚‹ï¼"
emoji: "ğŸ»"
type: "tech"
topics: ["php", "symfony"]
published: true
published_at: 2021-12-21
---

:::message
ã“ã®è¨˜äº‹ã¯ã€2021-12-21ã«åˆ¥ã®ãƒ–ãƒ­ã‚°åª’ä½“ã«æŠ•ç¨¿ã—ãŸè¨˜äº‹ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã§ã™ã€‚
:::

[Symfony Advent Calendar 2021](https://qiita.com/advent-calendar/2021/symfony) ã®21æ—¥ç›®ã®è¨˜äº‹ã§ã™ï¼ğŸ„ğŸŒ™

> ã¡ãªã¿ã«ã€åƒ•ã¯ã‚ˆã [Twitterã«ã‚‚Symfonyãƒã‚¿ã‚’å‘Ÿã„ã¦ã„ã‚‹](https://twitter.com/search?q=from%3Attskch%20(symfony%20OR%20doctrine)&src=typed_query&f=live) ã®ã§ã€ã‚ˆã‚ã—ã‘ã‚Œã°ãœã² [ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ã‚„ã£ã¦ãã ã•ã„ğŸ•ŠğŸ¤²](https://twitter.com/ttskch)

æ˜¨æ—¥ã¯ [@77web](https://twitter.com/77web) ã•ã‚“ã® [zenstruck/foundryã‚’ä½¿ã£ã¦ã¿ã‚‹](https://tech.quartetcom.co.jp/2021/12/20/foundry-the-new-fixtures-for-functional-testing/) ã§ã—ãŸâœ¨

# symfony/console ã¨ã¯

[symfony/console](https://symfony.com/doc/current/components/console.html) ã¯ã€ãƒ†ã‚¹ã‚¿ãƒ–ãƒ«ã‹ã¤è¦‹ãŸç›®ã«ã‚‚ç¾ã—ã„CLIã‚’ç°¡å˜ã«å®Ÿè£…ã§ãã‚‹ã‚ˆã†ãªè«¸æ©Ÿèƒ½ã‚’æä¾›ã—ã¦ãã‚Œã‚‹Symfonyã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã€PHPerã«ã¯ãŠé¦´æŸ“ã¿ã® [Composer](https://getcomposer.org/) ãªã©ã‚‚symfony/console ã‚’ä½¿ã£ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚

Symfonyãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ãªãã¨ã‚‚ã€æ¥­å‹™ã‚„æ—¥å¸¸ç”Ÿæ´»ã®ã¡ã‚‡ã£ã¨ã—ãŸä½œæ¥­ã‚’è‡ªå‹•åŒ–ã™ã‚‹ãŸã‚ã®CLIãƒ„ãƒ¼ãƒ«ã‚’ã‚µã‚µã£ã¨ä½œã£ãŸã‚Šã™ã‚‹ã®ã«ã¨ã¦ã‚‚ä¾¿åˆ©ãªã®ã§ã€ç°¡å˜ã«ç´¹ä»‹ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

# Hello, World!

ã¨ã‚Šã‚ãˆãš Hello, World! ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

ã¾ãšã¯ä»¥ä¸‹ã®ã‚ˆã†ãªå†…å®¹ã§ `composer.json` ã‚’ä½œæˆã—ã¦ã€

```json
{
    "require": {
        "symfony/console": "^6.0"
    },
    "autoload": {
        "psr-4": {
            "App\\": "src/"
        }
    }
}
```

`composer install` ã—ã¾ã™ã€‚

```bash
$ composer install
```

æ¬¡ã«ã‚³ãƒãƒ³ãƒ‰ã®ä¸­èº«ã‚’å®Ÿè£…ã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ãªå†…å®¹ã§ `./src/Command/WorldCommand.php` ã‚’ä½œæˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```php
<?php
namespace App\Command;

use Symfony\Component\Console\Command\Command;
use Symfony\Component\Console\Input\InputInterface;
use Symfony\Component\Console\Output\OutputInterface;

class WorldCommand extends Command
{
    protected static $defaultName = 'world';

    protected function execute(InputInterface $input, OutputInterface $output): int
    {
        echo 'Hello, World!';

        return Command::SUCCESS;
    }
}
```

ã“ã‚Œã§ã€`world` ã¨ã„ã†åå‰ã®ã€`Hello, World!` ã¨ `echo` ã™ã‚‹ã ã‘ã® ã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè£…ã§ãã¾ã—ãŸã€‚

æœ€å¾Œã«ã‚³ãƒãƒ³ãƒ‰ã‚’åŒ…æ‹¬ã™ã‚‹å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ãªå†…å®¹ã§ `./hello` ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚

```php
#!/usr/bin/env php
<?php
require __DIR__ . '/vendor/autoload.php';

use App\Command\WorldCommand;
use Symfony\Component\Console\Application;

$application = new Application();
$application->add(new WorldCommand());
$application->run();
```

> `#!/usr/bin/env php` ã¨ã„ã†Shebangã§å®Ÿè¡Œã•ã›ã‚‹ã®ã§ã€å½“ç„¶ãªãŒã‚‰PATHã®é€šã£ãŸå ´æ‰€ã« `php` ã‚³ãƒãƒ³ãƒ‰ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ç’°å¢ƒã§ãªã„ã¨å‹•ãã¾ã›ã‚“ã€‚

`./hello` ã¯å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ãªã®ã§ä»¥ä¸‹ã®ã‚ˆã†ãªæ„Ÿã˜ã§ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’å¤‰æ›´ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

```bash
$ chmod a+rx ./hello
```

ã“ã‚Œã§å®Œäº†ã§ã™ã€‚å‹•ã‹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```bash
$ ./hello
```

ã‚³ãƒãƒ³ãƒ‰ã‚’æŒ‡å®šã›ãšã«å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ä½¿ç”¨ã®æ‰‹å¼•ãã¨åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰ã®ä¸€è¦§ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚`composer` ã‚³ãƒãƒ³ãƒ‰ã¨åŒã˜ã§ã™ã­ã€‚

> è‡ªåˆ†ã§ã¯ä½•ã‚‚å®Ÿè£…ã—ã¦ã„ãªã„ã®ã«ã“ã®è¾ºã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒå‡ºæ¥ä¸ŠãŒã£ã¦ã„ã‚‹ã®ãŒè¶…ã‚ã‚ŠãŒãŸã„ã§ã™ã­ï¼

```
Console Tool

Usage:
  command [options] [arguments]

Options:
  -h, --help            Display help for the given command. When no command is given display help for the list command
  -q, --quiet           Do not output any message
  -V, --version         Display this application version
      --ansi|--no-ansi  Force (or disable --no-ansi) ANSI output
  -n, --no-interaction  Do not ask any interactive question
  -v|vv|vvv, --verbose  Increase the verbosity of messages: 1 for normal output, 2 for more verbose output and 3 for debug

Available commands:
  completion  Dump the shell completion script
  help        Display help for a command
  list        List commands
  world
```

æ¬¡ã¯ `world` ã‚³ãƒãƒ³ãƒ‰ã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```bash
$ ./hello world
Hello, World!
```

ã“ã¡ã‚‰ã¯ã€å…ˆã»ã©å®Ÿè£…ã—ãŸã¨ãŠã‚Š `Hello, World!` ã¨ã„ã†æ–‡å­—åˆ—ãŒå‡ºåŠ›ã•ã‚Œã¾ã—ãŸã€‚

# 1ã‚³ãƒãƒ³ãƒ‰ã—ã‹ãªã„ãƒ„ãƒ¼ãƒ«ã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚³ãƒãƒ³ãƒ‰ã‚’è¨­å®šã™ã‚Œã°ã‚³ãƒãƒ³ãƒ‰ã®æŒ‡å®šã‚’çœç•¥ã§ãã‚‹

ä»Šå›ã®ã‚ˆã†ã«1ã‚³ãƒãƒ³ãƒ‰ã—ã‹ãªã„CLIãƒ„ãƒ¼ãƒ«ã®å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚³ãƒãƒ³ãƒ‰ã‚’æŒ‡å®šã—ã¦ã‚ã’ã‚Œã°ã€ã‚³ãƒãƒ³ãƒ‰åã‚’çœç•¥ã—ã¦å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```diff
  #!/usr/bin/env php
  <?php
  require __DIR__ . '/vendor/autoload.php';
  
  use App\Command\WorldCommand;
  use Symfony\Component\Console\Application;
  
  $application = new Application();
  $application->add(new WorldCommand());
+ $application->setDefaultCommand('world');
  $application->run();
```

```bash
$ ./hello
Hello, World!
```

# å…¥åŠ›ã®å—ã‘å–ã‚Šã‚„å‡ºåŠ›ã®è£…é£¾ãŒã‚ã£ã¡ã‚ƒç°¡å˜ã«ã§ãã‚‹

symfony/console ã®æœ¬é ˜ãŒç™ºæ®ã•ã‚Œã‚‹ã®ã¯ã‚ã‚‹ç¨‹åº¦è¤‡é›‘ãªå…¥å‡ºåŠ›ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒå¿…è¦ã«ãªã‚‹å ´åˆã§ã™ã€‚

## å…¥åŠ›ã®å—ã‘å–ã‚Š

ä¾‹ãˆã°å…ˆã»ã©ã® `./hello world` ã‚³ãƒãƒ³ãƒ‰ã«ä»¥ä¸‹ã®ã‚ˆã†ãªå¼•æ•°ã‚’è¿½åŠ å®Ÿè£…ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

* `--names` ã¨ã„ã†ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ `'World'` ã®ä»£ã‚ã‚Šã«å‘¼ã³ã‹ã‘ã‚‹åå‰ã‚’0å€‹ã€œè¤‡æ•°å€‹æŒ‡å®šã§ãã‚‹
* `--count` ã¨ã„ã†ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§å‡ºåŠ›ã™ã‚‹å›æ•°ã‚’æŒ‡å®šã§ãã‚‹

ã“ã®å ´åˆã€`./src/Command/WorldCommand.php` ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè£…ã™ã‚‹ã“ã¨ã§å¯¾å¿œã§ãã¾ã™ã€‚

```php
protected function configure(): void
{
    $this
        ->setDescription('Hello, World! ã™ã‚‹')
        ->addOption('names', 'N', InputOption::VALUE_REQUIRED|InputOption::VALUE_IS_ARRAY, 'å‘¼ã³ã‹ã‘ã‚‹åå‰ï¼ˆè¤‡æ•°å¯ï¼‰', ['World'])
        ->addOption('count', 'c', InputOption::VALUE_REQUIRED, 'å‘¼ã³ã‹ã‘ã‚‹å›æ•°', 1)
    ;
}

protected function execute(InputInterface $input, OutputInterface $output): int
{
    $names = $input->getOption('names');
    $count = (int) $input->getOption('count');

    for ($i = 0; $i < $count; $i++) {
        echo 'Hello, ' . implode(', ', $names) . '!' . PHP_EOL;
    }

    return Command::SUCCESS;
}
```

`configure()` ãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚³ãƒãƒ³ãƒ‰ã®ä»•æ§˜ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

* ï¼ˆã‚‚ã®ã®ã¤ã„ã§ã«ï¼‰`setDescription()` ã§ã‚³ãƒãƒ³ãƒ‰è‡ªä½“ã®èª¬æ˜æ–‡ã‚’è¨­å®š
* `addOption()` ã§ `names` ãŠã‚ˆã³ `count` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’è¨­å®š
    * `names` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã¯
        *  `N` ã¨ã„ã†ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’è¨­å®šï¼ˆ `n` ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ `--no-interaction` ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã¨ã—ã¦ä½¿ã‚ã‚Œã¦ãŠã‚Šä½¿ç”¨ã§ããªã„ãŸã‚å¤§æ–‡å­—ã«ã—ã¦ã„ã‚‹ï¼‰
        * ãƒ¢ãƒ¼ãƒ‰ã¨ã—ã¦ `InputOption::VALUE_REQUIRED|InputOption::VALUE_IS_ARRAY` ã¤ã¾ã‚Šã€Œã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯å€¤ä»˜ãã§ãªã‘ã‚Œã°ãªã‚‰ãšã€é…åˆ—å½¢å¼ï¼ˆã¤ã¾ã‚Šè¤‡æ•°æŒ‡å®šå¯ï¼‰ã€ã¨ã„ã†å†…å®¹ã‚’è¨­å®š
        * ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒæŒ‡å®šã•ã‚Œãªã‹ã£ãŸå ´åˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯ `['World']` ã¨ã™ã‚‹
    * `count` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã¯
        * `c` ã¨ã„ã†ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’è¨­å®š
        * ãƒ¢ãƒ¼ãƒ‰ã¨ã—ã¦ `InputOption::VALUE_REQUIRED` ã¤ã¾ã‚Šã€Œã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯å€¤ä»˜ãã§ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€ã¨ã„ã†å†…å®¹ã‚’è¨­å®š
        * ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒæŒ‡å®šã•ã‚Œãªã‹ã£ãŸå ´åˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯ `1` ã¨ã™ã‚‹

ã“ã‚Œã‚’å—ã‘ã¦ã€ã‚³ãƒãƒ³ãƒ‰ã®å‡¦ç†æœ¬ä½“ã§ã‚ã‚‹ `execute()` ãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯

```php
$names = $input->getOption('names');
$count = (int) $input->getOption('count');
```

ã¨ã„ã†æ„Ÿã˜ã§å¼•æ•°ã¨ã—ã¦å…¥åŠ›ã•ã‚ŒãŸå€¤ã‚’å–ã‚Šå‡ºã—ã¦ã„ã¾ã™ã€‚

å®Ÿéš›ã«å‹•ã‹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

![](https://tva1.sinaimg.cn/large/008i3skNgy1gxljg8ry9nj30wm0u0ae5.jpg)

ã“ã®ã‚ˆã†ã«ã€é©åˆ‡ã«å¼•æ•°ãŒæ¸¡ã›ã¦ã€ã—ã‹ã‚‚ã€Œå€¤ä»˜ãã§ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€ã¨ã—ãŸã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒå€¤ãªã—ã§å®Ÿè¡Œã•ã‚ŒãŸå ´åˆã«ã¯é©åˆ‡ã«ã‚¨ãƒ©ãƒ¼ã‚’åã„ã¦ãã‚Œã¾ã™ã€‚ä¾¿åˆ©ï¼

## å‡ºåŠ›ã®è£…é£¾

å…¥åŠ›ã®å—ã‘å–ã‚Šã ã‘ã§ãªãã€å‡ºåŠ›ã®è£…é£¾ã‚‚ç°¡å˜ã§ã™ã€‚

ä¾‹ãˆã°ã€ï¼ˆã“ã®ä¾‹ã§ã¯å®Ÿç”¨ä¸Šã¾ã£ãŸãé©åˆ‡ã§ã¯ãªã„ã§ã™ãŒï¼‰å‡ºåŠ›ã‚’ãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ã«ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

symfony/console ã«çµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ [`Table` ã¨ã„ã†ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¹](https://symfony.com/doc/current/components/console/helpers/table.html) ã‚’ä½¿ãˆã°è¶…ç°¡å˜ã«å®Ÿè£…ã§ãã¾ã™ã€‚

```php
protected function execute(InputInterface $input, OutputInterface $output): int
{
    $names = $input->getOption('names');
    $count = (int) $input->getOption('count');

    $table = new Table($output);
    for ($i = 0; $i < $count; $i++) {
        $table->addRow(array_merge(['Hello'], $names));
    }
    $table->render();

    return Command::SUCCESS;
}
```

![](https://tva1.sinaimg.cn/large/008i3skNgy1gxljgxbie5j31vw0fydiz.jpg)

ä¾¿åˆ©ï¼

`Table` ä»¥å¤–ã«ã‚‚ã€å¯¾è©±å¼ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ç°¡å˜ã«å®Ÿè£…ã§ãã‚‹ [`Question`](https://symfony.com/doc/current/components/console/helpers/questionhelper.html) ã‚„ã€ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’ç°¡å˜ã«å®Ÿè£…ã§ãã‚‹ [`ProgressBar`](https://symfony.com/doc/current/components/console/helpers/progressbar.html) ãªã©ã€ä¾¿åˆ©ãªãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¹ãŒè‰²ã€…ã¨ç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚

è©³ç´°ã¯ [å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://symfony.com/doc/current/console.html#learn-more) ã‹ã‚‰è¾¿ã£ã¦ã¿ã¦ãã ã•ã„ã€‚

ã“ã†ã„ã£ãŸä¾¿åˆ©ãªãƒ˜ãƒ«ãƒ‘ãƒ¼ã®ãŠã‹ã’ã§UIã®å®Ÿè£…ã«ã¤ã„ã¦ã¯è‡ªåˆ†ã§ã»ã¼ä½•ã‚‚æ›¸ãå¿…è¦ãŒãªãã€ã‚³ãƒãƒ³ãƒ‰ã®å‡¦ç†ã®æœ¬è³ªã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã§ãã¦ã¨ã¦ã‚‚å¬‰ã—ã„ã§ã™ã­ï¼

# ãŠã‚ã‚Šã«

ã¨ã„ã†ã‚ã‘ã§ã€[symfony/console](https://symfony.com/doc/current/components/console.html) ã‚’ç°¡å˜ã«ç´¹ä»‹ã—ã¦ã¿ã¾ã—ãŸï¼Symfonyãƒ¦ãƒ¼ã‚¶ãƒ¼ä»¥å¤–ã®PHPerã®æ–¹ã‚‚ãœã²æ´»ç”¨ã—ã¦ã¿ã¦ã„ãŸã ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ğŸ˜‰

[Symfony Advent Calendar 2021](https://qiita.com/advent-calendar/2021/symfony)ã€æ˜æ—¥ã¯ [@chanshige](https://qiita.com/chanshige) ã•ã‚“ã§ã™ï¼ãŠæ¥½ã—ã¿ã«ï¼
