---
title: "Node.jsã‹ã‚‰GitHubã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã¾ãŸã¯æ›´æ–°ã™ã‚‹"
emoji: "ğŸ™"
type: "tech"
topics: ["javascript", "nodejs", "github"]
published: true
published_at: 2020-05-26
---

:::message
ã“ã®è¨˜äº‹ã¯ã€2020-05-26ã«åˆ¥ã®ãƒ–ãƒ­ã‚°åª’ä½“ã«æŠ•ç¨¿ã—ãŸè¨˜äº‹ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã§ã™ã€‚
:::

Node.jsã‹ã‚‰GitHub APIã‚’ä½¿ã£ã¦GitHubä¸Šã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã€ã¾ãŸã¯æ—¢å­˜ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°ã™ã‚‹å…·ä½“çš„ãªæ‰‹é †ã‚’è§£èª¬ã—ã¾ã™ã€‚

# APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

Node.jsç”¨ã®GitHub APIã®å…¬å¼ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ [octokit/rest.js](https://github.com/octokit/rest.js) ã§ã™ã€‚ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã¯ [ã“ã¡ã‚‰](https://octokit.github.io/rest.js/v17/)ã€‚

ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆã¾ãŸã¯æ›´æ–°ã«ã¯ã€ [`octokit.repos.createOrUpdateFile()`](https://octokit.github.io/rest.js/v17#repos-create-or-update-file) ã‚’ä½¿ã„ã¾ã™ã€‚

# ãƒ•ã‚¡ã‚¤ãƒ«ã®æ–°è¦ä½œæˆ

ãƒ•ã‚¡ã‚¤ãƒ«ã®æ–°è¦ä½œæˆã®å ´åˆã¯ã€å¿…é ˆã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯

* `owner` ï¼ˆãƒªãƒã‚¸ãƒˆãƒªã®ã‚ªãƒ¼ãƒŠãƒ¼åï¼‰
* `repo` ï¼ˆãƒªãƒã‚¸ãƒˆãƒªåï¼‰
* `path` ï¼ˆãƒ«ãƒ¼ãƒˆã‹ã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã€‚å…ˆé ­ã« `/` ã¯ä¸è¦ï¼‰
* `message` ï¼ˆã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰
* `content` ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã€‚Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸæ–‡å­—åˆ—ã¨ã—ã¦æ¸¡ã™ï¼‰

ã§ã™ã€‚

Node.jsã§æ–‡å­—åˆ—ã‚’Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹ã«ã¯ã€ [`Buffer` ã‚¯ãƒ©ã‚¹](https://nodejs.org/api/buffer.html#buffer_buffers_and_character_encodings) ã‚’ä½¿ã„ã¾ã™ã€‚

å…·ä½“çš„ãªã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚

```js
octokit.repos.createOrUpdateFile({
  owner: 'owner-name',
  repo: 'repo-name',
  path: 'path/to/file',
  message: 'commit message',
  content: Buffer.from('file content').toString('base64'),
})
```

# æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°

æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°ã®å ´åˆã¯ã€ `owner` `repo` `path` `message` `content` ã«åŠ ãˆã¦ã€

* `sha` ï¼ˆæ›´æ–°å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒã‚·ãƒ¥å€¤ï¼‰

ãŒå¿…é ˆã¨ãªã‚Šã¾ã™ã€‚

ãªã®ã§ã€å…ˆã« [`octokit.repos.getContents()`](https://octokit.github.io/rest.js/v17#repos-get-contents) ã‚’ä½¿ã£ã¦ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒã‚·ãƒ¥å€¤ã‚’å–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```js
octokit.repos.getContents({
  owner: 'owner-name',
  repo: 'repo-name',
  path: 'path/to/file',
})
```

ãŸã ã—ã€æŒ‡å®šã—ãŸãƒ‘ã‚¹ã«ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯404ã§ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã—ã¾ã†ã®ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã«404ã‚’ç„¡è¦–ã—ã¦å‡¦ç†ã‚’ç¶šè¡Œã™ã‚‹ã‚ˆã†ãªå®Ÿè£…ãŒå¿…è¦ã§ã™ã€‚

```js
let file
try {
  file = await octokit.repos.getContents({
    owner: 'owner-name',
    repo: 'repo-name',
    path: 'path/to/file',
  })
} catch (e) {
  if (e.status !== 404) {
    throw e
  }
  file = null
}

octokit.repos.createOrUpdateFile({
  owner: 'owner-name',
  repo: 'repo-name',
  path: 'path/to/file',
  message: 'commit message',
  content: Buffer.from('file content').toString('base64'),
  sha: file ? file.data.sha : null,
})
```

# See also

æ‹™ä½œã® [esa2github](https://github.com/ttskch/esa2github/) ã« [å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚‹](https://github.com/ttskch/esa2github/blob/master/src/github.js) ã®ã§ã€ã‚ã‚ã›ã¦å‚è€ƒã«ã—ã¦ã¿ã¦ãã ã•ã„âœ‹
