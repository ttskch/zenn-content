---
title: "[Symfony] æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã§createClinet()ã‚’è¤‡æ•°å›å®Ÿè¡Œã™ã‚‹ã®ã¯Symfony 4.4ä»¥é™ã§éæ¨å¥¨ã«ãªã£ã¦ã„ã‚‹ã®ã§æ³¨æ„"
emoji: "ğŸ»"
type: "tech"
topics: ["php", "symfony", "æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ"]
published: true
published_at: 2020-08-01
---

:::message
ã“ã®è¨˜äº‹ã¯ã€2020-08-01ã«åˆ¥ã®ãƒ–ãƒ­ã‚°åª’ä½“ã«æŠ•ç¨¿ã—ãŸè¨˜äº‹ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã§ã™ã€‚
:::

# Symfony 4.4ä»¥é™ã¯ `createClient()` ã¯è¤‡æ•°å›å®Ÿè¡Œã—ã¦ã¯ã„ã‘ãªã„

Symfony 4.4ä»¥ä¸Šã§æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã„ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ãªdeprecation noticeãŒå‡ºãŸã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿ

```
1x: Calling "Symfony\Bundle\FrameworkBundle\Test\WebTestCase::createClient()" while a kernel has been booted is deprecated since Symfony 4.4 and will throw in 5.0, ensure the kernel is shut down before calling the method.
  1x in FooControllerTest::testIndex from App\Controller
```

ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ ã‚’èª­ã‚€ã¨ã€ã‚«ãƒ¼ãƒãƒ«ãŒèµ·å‹•ã—ã¦ã„ã‚‹çŠ¶æ…‹ã§ã•ã‚‰ã«åˆ¥ã®ã‚«ãƒ¼ãƒãƒ«ã‚’èµ·å‹•ã•ã›ã‚‹è¡Œç‚ºã¯Symfony 4.4ä»¥é™ã§éæ¨å¥¨ã¨ãªã£ã¦ã„ã‚‹ã¨ã®ã“ã¨ã§ã™ã€‚

ã‚ˆãã‚ã‚‹ã€ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã®ã‚ã‚‹ã‚µã‚¤ãƒˆã§BASICèªè¨¼ã‚’ä½¿ã£ã¦ç•°ãªã‚‹ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’è¤‡æ•°ä½œæˆã™ã‚‹ã‚ˆã†ãªãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã„ã‚‹ã¨ã€ã“ã®éæ¨å¥¨ã«æŠµè§¦ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ğŸ¤”

# è§£æ±ºæ–¹æ³•

[ã“ã¡ã‚‰ã®Stack Overflow](https://stackoverflow.com/questions/59672899/symfony-4-4-deprecation-warning-for-multiple-clients-in-user-test-is-deprecated) ã«ã‚ã‚‹ã¨ãŠã‚Šã€ `WebTestCase` ã‚¯ãƒ©ã‚¹ãŒ `ensureKernelShutdown()` ã¨ã„ã†æ—¢å­˜ã®ã‚«ãƒ¼ãƒãƒ«ã‚’ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã—ã¦ãã‚Œã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æä¾›ã—ã¦ãã‚Œã¦ã„ã‚‹ã®ã§ã€2ã¤ç›®ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ç”Ÿæˆã™ã‚‹å‰ã«ã“ã‚Œã‚’å‘¼ã³å‡ºã™ã‚ˆã†ã«ã—ã¦ãŠã‘ã°ã€deprecation noticeã¯å‡ºãªããªã‚Šã¾ã™ã€‚

```diff
+ self::ensureKernelShutdown();
  self::createClient();
```

> [liip/test-fixtures-bundle](https://blog.ttskch.com/symfony4-liip-test-fixtures-bundle-practice/) ã® `FixturesTrait` ã‚’å°å…¥ã—ã¦ `setUp()` å†…ã§ `loadFixtureFiles()` ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹å ´åˆã¯ã€ã©ã†ã‚„ã‚‰å†…éƒ¨ã§ `createClient()` ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ãªã®ã§ã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ä¸­ã®1ã¤ç›®ã® `createClient()` ã«å¯¾ã—ã¦ã‚‚ã“ã®å¯¾å¿œãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚

æ¯å› `self::ensureKernelShutdown()` ã‚’å‘¼ã³å‡ºã™ã®ã¯æ‰‹é–“ãªã®ã§ã€ `createClient()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã—ã¦ã—ã¾ã†ã®ãŒã‚ˆã„ã¨æ€ã„ã¾ã™ã€‚

```php
protected static function createClient(array $options = [], array $server = []): KernelBrowser
{
    self::ensureKernelShutdown();

    return parent::createClient($options, $server);
}
```

ã“ã‚Œã‚’ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹ã«æ›¸ã„ã¦ãŠã‘ã°ã€ä»Šã¾ã§ã©ãŠã‚Šæ™®é€šã« `self::createClient()` ã—ã¦ã‚‚å†…éƒ¨ã§ `self::ensureKernelShutdown()` ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã®ã§deprecation noticeã¯å‡ºã¾ã›ã‚“ğŸ‘Œ
