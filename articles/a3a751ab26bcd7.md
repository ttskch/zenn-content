---
title: "[Mac] phpenvï¼ˆphp-buildï¼‰ã§PHP 8.0.0ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹æ–¹æ³•"
emoji: "ğŸ˜"
type: "tech"
topics: ["php", "phpenv", "php", "build", "mac"]
published: true
published_at: 2020-12-09
---

:::message
ã“ã®è¨˜äº‹ã¯ã€2020-12-09ã«åˆ¥ã®ãƒ–ãƒ­ã‚°åª’ä½“ã«æŠ•ç¨¿ã—ãŸè¨˜äº‹ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã§ã™ã€‚
:::

# ã¯ã˜ã‚ã«

phpenvã«ã‚ˆã‚‹PHPã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã‚ˆã†ã¨ã™ã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚ˆã£ã¦ç´°ã‹ã„å¯¾å¿œãŒå¿…è¦ãªå ´åˆãŒã‚ã‚Šã¾ã™ã€‚

ä»¥ä¸‹ã®ãƒšãƒ¼ã‚¸ã«æœ¬ãƒ–ãƒ­ã‚°å†…ã®é–¢é€£è¨˜äº‹ã‚’ã¾ã¨ã‚ã¦ã„ã¾ã™ã®ã§ã€å¿…è¦ã«å¿œã˜ã¦ã”å‚ç…§ãã ã•ã„ğŸ™

> [[2020å¹´æœ«ç‰ˆ] Macã§ã®phpenvï¼ˆphp-buildï¼‰ã«ã‚ˆã‚‹PHP 5.6ã€œ8.0ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã¾ã¨ã‚ | blog.ttskch](https://blog.ttskch.com/mac-phpenv-php-build/)

# phpenvï¼ˆphp-buildï¼‰ã§PHP 8.0.0ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã‚ˆã†ã¨ã—ãŸã‚‰ `implicit declaration of function 'gdPngGetVersionString'` ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ã«ãªã£ãŸ

å…ˆæ—¥ã‚ã§ãŸãPHP 8.0.0ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã€[php-buildã‹ã‚‰ã‚‚åˆ©ç”¨å¯èƒ½ã«ãªã‚Šã¾ã—ãŸ](https://github.com/php-build/php-build/commit/c2a67554866254dd00f33decea332536a0bee5fe#diff-4a129e7ec8d8f54b8e04062ec98ce5699f72f12b62a50ef19fe036855c2a02b3) ğŸ‰

æ—©é€Ÿã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã‚ˆã†ã¨ã—ã¦ã¿ãŸã¨ã“ã‚ã€

```
[Info]: Loaded extension plugin
[Info]: Loaded apc Plugin.
[Info]: Loaded composer Plugin.
[Info]: Loaded github Plugin.
[Info]: Loaded uprofiler Plugin.
[Info]: Loaded xdebug Plugin.
[Info]: Loaded xhprof Plugin.
[Info]: Loaded zendopcache Plugin.
[Info]: php.ini-production gets used as php.ini
[Info]: Building 8.0.0 into /Users/ttskch/.phpenv/versions/8.0.0
[Skipping]: Already downloaded and extracted https://secure.php.net/distributions/php-8.0.0.tar.bz2
[Preparing]: /var/tmp/php-build/source/8.0.0
[Compiling]: /var/tmp/php-build/source/8.0.0

-----------------
|  BUILD ERROR  |
-----------------

Here are the last 10 lines from the log:

-----------------------------------------
/var/tmp/php-build/source/8.0.0/ext/gd/gd.c:521:48: error: implicit declaration of function 'gdPngGetVersionString' is invalid in C99 [-Werror,-Wimplicit-function-declaration]
        php_info_print_table_row(2, "libPNG Version", gdPngGetVersionString());
                                                      ^
/var/tmp/php-build/source/8.0.0/ext/gd/gd.c:521:48: note: did you mean 'gdVersionString'?
/usr/local/include/gd.h:1630:27: note: 'gdVersionString' declared here
BGD_DECLARE(const char *) gdVersionString(void);
                          ^
2 errors generated.
make: *** [ext/gd/gd.lo] Error 1
make: *** Waiting for unfinished jobs....
-----------------------------------------

The full Log is available at '/tmp/php-build.8.0.0.2020xxxxxxxxxx.log'.
[Warn]: Aborting build.
```

ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ã«ã€‚

ä»Šå›ã¯ã“ã‚Œã‚’è§£æ¶ˆã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãŸã‚ã«å¿…è¦ãªã“ã¨ã‚’èª¬æ˜ã—ã¾ã™âœ‹

# çµè«–ï¼šHomebrewã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸgdã‚’ä½¿ã†ã‚ˆã†ã«ã™ã‚Œã°ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹

ã¡ã‚‡ã£ã¨è©³ç´°ã¾ã§ç†è§£ã—ã¦ã„ã¾ã›ã‚“ãŒã€**ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¦ã€Homebrewã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸgdã‚’ä½¿ã†ã‚ˆã†ã«ã™ã‚Œã°ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã—ãŸã€‚**

```
--with-external-gd=/usr/local/opt/gd
```

> å‚è€ƒï¼š<https://www.php.net/manual/ja/image.installation.php>

ã¡ãªã¿ã«åƒ•ã®ç’°å¢ƒã§ã¯gdã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯2.3.0ã§ã™ã€‚

```bash
$ brew info gd
gd: stable 2.3.0 (bottled), HEAD
```

# å®Ÿéš›ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚³ãƒãƒ³ãƒ‰

ä»Šå›åƒ•ãŒå®Ÿéš›ã«å®Ÿè¡Œã—ãŸã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚³ãƒãƒ³ãƒ‰ã¯ä»¥ä¸‹ã§ã™ã€‚

```bash
export PATH=/usr/local/opt/bison/bin:$PATH
export PKG_CONFIG_PATH=/usr/local/opt/krb5/lib/pkgconfig:/usr/local/opt/openssl/lib/pkgconfig:/usr/local/opt/icu4c/lib/pkgconfig:/usr/local/opt/libedit/lib/pkgconfig:/usr/local/opt/libxml2/lib/pkgconfig
export PHP_BUILD_INSTALL_EXTENSION="apcu=@ imagick=@"
export PHP_BUILD_EXTRA_MAKE_ARGUMENTS=-j4
export PHP_BUILD_CONFIGURE_OPTS="--with-zlib-dir=/usr/local/opt/zlib --with-bz2=/usr/local/opt/bzip2 --with-iconv=/usr/local/opt/libiconv --with-curl=/usr/local/opt/curl --with-libedit=/usr/local/opt/libedit --with-jpeg-dir=/usr/local/opt/libjpeg --with-png-dir=/usr/local/opt/libpng --with-external-gd=/usr/local/opt/gd"
phpenv install 8.0.0
```



ã¡ãªã¿ã«ç’°å¢ƒã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã€‚

* macOS Big Sur 11.0.1
* Xcode 12.2
* phpenv v0.9.0-rc.1
* php-build v0.11.0dev
