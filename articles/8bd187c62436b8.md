---
title: "PHPãŒçªç„¶Library not loaded: /path/to/libicui18n.64.dylibã¨ã‹è¨€ã„å‡ºã—ãŸã¨ãã®å¯¾å‡¦æ³•"
emoji: "ğŸ˜"
type: "tech"
topics: ["php", "mac"]
published: true
published_at: 2020-07-16
---

:::message
ã“ã®è¨˜äº‹ã¯ã€2020-07-16ã«åˆ¥ã®ãƒ–ãƒ­ã‚°åª’ä½“ã«æŠ•ç¨¿ã—ãŸè¨˜äº‹ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã§ã™ã€‚
:::

# èµ·ã“ã£ãŸã“ã¨

phpenvã§å…¥ã‚Œã¦ã„ã‚‹PHPãŒã€ã‚ã‚‹æ—¥çªç„¶ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ã§å‹•ä½œã—ãªããªã‚Šã¾ã—ãŸğŸ™„

```bash
$ php -v
dyld: Library not loaded: /usr/local/opt/icu4c/lib/libicuio.64.dylib
  Referenced from: /Users/xxx/.phpenv/versions/7.4.5/bin/php
  Reason: image not found
[1]    91168 abort      php -v
```

# è§£æ±ºæ–¹æ³•

ã»ã¨ã‚“ã©ã®å ´åˆã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹icu4cã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒæ–°ã—éãã‚‹ã“ã¨ãŒåŸå› ã§ã™ã€‚ç›´è¿‘ã§ `brew upgrade` ã¨ã‹ã‚’å®Ÿè¡Œã—ãŸå¿ƒå½“ãŸã‚Šã¯ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿ

ã¨ã„ã†ã‚ã‘ã§ã€icu4cã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’PHPãŒä¾å­˜ã—ã¦ã„ã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æˆ»ã—ã¦ã‚ã’ã‚Œã°ç›´ã‚Šã¾ã™ã€‚

ä»Šå›ã®ä¾‹ã ã¨

```
dyld: Library not loaded: /usr/local/opt/icu4c/lib/libicuio.64.dylib
```

ã¨è¨€ã‚ã‚Œã¦ã„ã‚‹ã®ã§ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³64ç³»ã¾ã§æˆ»ã—ã¦ã‚ã’ã‚Œã°ã‚ˆã„ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

å®Ÿéš›ã€ `brew info icu4c` ã—ã¦ã¿ã‚‹ã¨ã€æœ€æ–°ã®67.1ãŒå…¥ã£ã¦ã„ã¾ã—ãŸã€‚

```bash
$ brew info icu4c
icu4c: stable 67.1 (bottled) [keg-only]
```

Homebrewã§å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹æ–¹æ³•ã¯

* [Homebrewã§æ—§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã„ - Qiita](https://qiita.com/KyoheiG3/items/912bcc27462871487845)
* [postgresql - Install icu4c version 63 with Homebrew - Stack Overflow](https://stackoverflow.com/questions/55826221/install-icu4c-version-63-with-homebrew/55828190#55828190)

ã‚ãŸã‚ŠãŒå‚è€ƒã«ãªã‚Šã¾ã™ã€‚ç‰¹ã«ä»Šå›ã¯åŒã˜icu4cã®ä¾‹ã§ã‚ã‚‹å¾Œè€…ãŒãã®ã¾ã¾å‚è€ƒã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚

ä»¥ä¸‹ã«å…·ä½“çš„ãªæ‰‹é †ã‚’ç¤ºã—ã¾ã™ã€‚

## 0. å¿µã®ãŸã‚icu4cã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ç›´ã—ã¦ãŠã

```bash
$ brew update && brew reinstall icu4c
```

## 1. Homebrewã®Formulaãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•

```bash
$ cd $(brew --prefix)/Homebrew/Library/Taps/homebrew/homebrew-core/Formula
```

## 2. icu4cã®ã‚³ãƒŸãƒƒãƒˆãƒ­ã‚°ã‚’èª¿ã¹ã‚‹

```bash
$ git log --follow icu4c.rb
```

```
:
commit c78114de1252ac63590b06c1f2325e576a5d5226
Author: Pavel Omelchenko <p.Omelchenko@gmail.com>
Date:   Fri Apr 3 00:58:01 2020 +0300

    icu4c 66.1

commit a806a621ed3722fb580a58000fb274a2f2d86a6d
Author: Thierry Moisan <thierry.moisan@gmail.com>
Date:   Wed Oct 2 13:07:31 2019 -0400

    icu4c: update homepage and url (#44812)

commit 896d1018c7a4906f2c3fa1386aaf283497db60a2   ## <-- ã“ã‚Œ
Author: BrewTestBot <homebrew-test-bot@lists.sfconservancy.org>
Date:   Sat Sep 28 13:49:39 2019 +0000

    icu4c: update 64.2 bottle.

commit c81a048b0ebea0ba976af220806fb8ef35201e9a
Author: BrewTestBot <homebrew-test-bot@lists.sfconservancy.org>
Date:   Fri Apr 19 03:35:49 2019 +0000

    icu4c: update 64.2 bottle.
:
```

ä»Šå›ã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³64ç³»ã¾ã§æˆ»ã—ãŸã„ã®ã§ã€ `896d1018c7a4906f2c3fa1386aaf283497db60a2` æ™‚ç‚¹ã®ã‚‚ã®ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚

## 3. ç›®çš„ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ç›¸å½“ã™ã‚‹ã‚³ãƒŸãƒƒãƒˆã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ

```bash
$ git checkout 896d1018c7a4906f2c3fa1386aaf283497db60a2
```

## 4. ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã—ãŸã‚³ãƒ¼ãƒ‰ã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
$ brew reinstall ./icu4c.rb
```

## 5. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ç›´ã—ãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¹ã‚¤ãƒƒãƒ

```bash
$ brew switch icu4c 64.2
```

## 6. ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã ã‘masterã«æˆ»ã™

```bash
$ git checkout master
```

ã“ã‚Œã§ã€ç„¡äº‹ã«PHPãŒå‹•ä½œã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸğŸ‘

```bash
$ php -v
PHP 7.4.5 (cli) (built: Jul 14 2020 10:25:09) ( NTS )
Copyright (c) The PHP Group
Zend Engine v3.4.0, Copyright (c) Zend Technologies
    with Zend OPcache v7.4.5, Copyright (c), by Zend Technologies
    with Xdebug v2.9.5, Copyright (c) 2002-2020, by Derick Rethans
```

# å†ç™ºã—ãŸã¨ãã®ãŸã‚ã®æº–å‚™

`brew update` ã—ãŸã‚Šã€ä½•ã‹ã®ãƒ•ã‚©ãƒ¼ãƒŸãƒ¥ãƒ©ã‚’ `brew upgrade` ã—ãŸã¨ãã«ã€ä¸€ç·’ã«icu4cã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒä¸ŠãŒã£ã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã®ã‚ˆã†ã«å‰²ã¨é »ç¹ã«å†ç™ºã™ã‚‹å•é¡Œãªã®ã§ã€æ¯å›é¢å€’ãªä½œæ¥­ã‚’ã—ãªãã¦æ¸ˆã‚€ã‚ˆã†ã«ä¸€é€£ã®ä½œæ¥­ã‚’ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ã—ã¦ãŠãã¨ä¾¿åˆ©ã§ã™ã€‚

ã¡ãªã¿ã«ã€PHP7.3ä»¥ä¸‹ã ã¨icu4cã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³64ã§ã¯ãªã63ãŒå¿…é ˆãªã‚ˆã†ï¼ˆä½“é¨“è«‡ï¼‰ãªã®ã§ã€åƒ•ã®å ´åˆã¯63ã¨64ãã‚Œãã‚Œã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æˆ»ã™ãŸã‚ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œã£ã¦ã‚ã‚Šã¾ã™ã€‚

```bash
# switch-to-icu4c63.sh

#!/bin/sh

cd $(brew --prefix)/Homebrew/Library/Taps/homebrew/homebrew-core/Formula
git checkout e7f0f10dc63b1dc1061d475f1a61d01b70ef2cb7
brew reinstall ./icu4c.rb
brew switch icu4c 63.1
git checkout master
cd -
```

```bash
# switch-to-icu4c64.sh

#!/bin/sh

cd $(brew --prefix)/Homebrew/Library/Taps/homebrew/homebrew-core/Formula
git checkout 896d1018c7a4906f2c3fa1386aaf283497db60a2
brew reinstall ./icu4c.rb
brew switch icu4c 64.2
git checkout master
cd -
```

# é–¢é€£ãƒ„ã‚¤ãƒ¼ãƒˆ


https://twitter.com/ttskch/status/1215999383704981504


https://twitter.com/ttskch/status/1215999607471128576


https://twitter.com/ttskch/status/1215999632578211840
