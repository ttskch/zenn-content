---
title: "[Symfony] ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼ˆãƒªã‚½ãƒ¼ã‚¹ï¼‰ã®æ‰€æœ‰è€…ä»¥å¤–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç¦æ­¢ã™ã‚‹"
emoji: "ğŸ»"
type: "tech"
topics: ["php", "symfony"]
published: true
published_at: 2020-04-14
---

:::message
ã“ã®è¨˜äº‹ã¯ã€2020-04-14ã«åˆ¥ã®ãƒ–ãƒ­ã‚°åª’ä½“ã«æŠ•ç¨¿ã—ãŸè¨˜äº‹ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã§ã™ã€‚
:::

ã€Œã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®è©³ç´°è¡¨ç¤ºã¯èª°ã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‘ã©ã€ç·¨é›†ç”»é¢ã¯ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®æ‰€æœ‰è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ãªã„ã¨ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯ã€ã¨ã„ã£ãŸè¦ä»¶ã¯ã‚ˆãã‚ã‚Šã¾ã™ã€‚

ã“ã‚Œã‚’Symfonyã§å®Ÿç¾ã™ã‚‹å ´åˆã®æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¦ã¿ã¾ã™ã€‚

# æ„šç›´ãªæ–¹æ³•

æ™®é€šã«ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰ã®å…ˆé ­ã«ifæ–‡ã‚’æ›¸ã‘ã°å¯¾å¿œã§ãã¾ã™ã­ã€‚çœŸã£å…ˆã«æ€ã„ã¤ãã®ã¯ã“ã®æ–¹æ³•ã§ã—ã‚‡ã†ã€‚

```php
/**
 * @Route("/foo", name="foo_")
 */
class FooController extends AbstractController
{
    // ...

    /**
     * @Route("/{id}/edit", name="edit", methods={"GET","POST"})
     */
    public function edit(Foo $foo)
    {
        if ($foo->getUser() != $this->getUser()) {
            throw new AccessDeniedHttpException();
        }

        // ...
    }
}
```

# æ‰‹è»½ãªæ–¹æ³•

`@Security` ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ã†ã¨ã€ã‚‚ã†å°‘ã—ã‚¹ãƒƒã‚­ãƒªæ›¸ã‘ã¾ã™ã€‚

å‚è€ƒï¼š <https://symfony.com/doc/4.2/best_practices/security.html#using-expressions-for-complex-security-restrictions>

```php
use Sensio\Bundle\FrameworkExtraBundle\Configuration\Security;

/**
 * @Route("/foo", name="foo_")
 */
class FooController extends AbstractController
{
    // ...

    /**
     * @Route("/{id}/edit", name="edit", methods={"GET","POST"})
     * @Security("foo.getUser() == user")
     */
    public function edit(Foo $foo)
    {
        // ...
    }
}
```

ã‚¹ãƒƒã‚­ãƒªã—ã¦ã¦ã„ã„æ„Ÿã˜ã§ã™ã­ã€‚

ãŸã ã—ã€ `@Security` ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ã†ãŸã‚ã«ã¯ [symfony/expression-language](https://symfony.com/doc/current/components/expression_language.html) ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

symfony/expression-languageãŒå…¥ã£ã¦ã„ãªã„çŠ¶æ…‹ã§ `@Security` ã‚’ä½¿ãŠã†ã¨ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚

```
To use the @Security tag, you need to use the Security component 2.4 or newer and install the ExpressionLanguage component.
```

# ã¾ã¨ã‚

* ã€Œã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®è©³ç´°è¡¨ç¤ºã¯èª°ã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‘ã©ã€ç·¨é›†ç”»é¢ã¯ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®æ‰€æœ‰è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ãªã„ã¨ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯ã€ã¨ã„ã†è¦ä»¶ã‚’Symfonyã§å®Ÿè£…ã™ã‚‹å ´åˆã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰ã«ifæ–‡ã‚’æ›¸ã„ã¦ã‚‚ã„ã„ã‘ã©ã€[`@Security` ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³](https://symfony.com/doc/4.2/best_practices/security.html#using-expressions-for-complex-security-restrictions) ã‚’ä½¿ã†ã¨ã‚¹ãƒƒã‚­ãƒªæ›¸ã‘ã¦ã‚ˆã„
* ãŸã ã— [symfony/expression-language](https://symfony.com/doc/current/components/expression_language.html) ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§è¦æ³¨æ„
