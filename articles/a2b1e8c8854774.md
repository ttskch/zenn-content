---
title: "[Flutterå…¥é–€ï¼ˆ5ï¼‰] å…¬å¼ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®ã‚¹ãƒ†ãƒƒãƒ—2ï¼šAdding interactivityï¼ˆç•¥ï¼‰ã‚’ã‚„ã£ã¦ã¿ã‚‹"
emoji: "ğŸ’»"
type: "tech"
topics: ["flutter"]
published: true
published_at: 2020-07-01
---

:::message
ã“ã®è¨˜äº‹ã¯ã€2020-07-01ã«åˆ¥ã®ãƒ–ãƒ­ã‚°åª’ä½“ã«æŠ•ç¨¿ã—ãŸè¨˜äº‹ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã§ã™ã€‚
:::

Flutterã®å…¬å¼ã‚µã‚¤ãƒˆã« [ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«](https://flutter.dev/docs/reference/tutorials) ã¨ã—ã¦ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’é †ã«ã‚„ã£ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚

ä»Šå›ã¯2ã¤ç›®ã® [Adding interactivity to your Flutter app](https://flutter.dev/docs/development/ui/interactive) ã§ã™ã€‚

å‰å›ä½œæˆã—ãŸã‚¢ãƒ—ãƒªã¯ç¾åœ¨ä¸‹å›³ã®ã‚ˆã†ãªè¦‹ãŸç›®ã«ãªã£ã¦ã„ã¾ã™ã€‚

![](https://tva1.sinaimg.cn/large/007S8ZIlgy1ggblbxig13j30dy0m8jud.jpg)

ä»Šå›ã¯ã“ã®ç”»é¢ã®èµ¤ã„â˜…ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ãã¾ã™ã€‚ä¸‹å›³ã®ã‚ˆã†ã«ã€ã‚¿ãƒƒãƒ—ã™ã‚‹ãŸã³ã«ã€ŒãŠæ°—ã«å…¥ã‚Šè¿½åŠ æ¸ˆã¿ã€ã¨ã€ŒãŠæ°—ã«å…¥ã‚Šæœªè¿½åŠ ã€ã®çŠ¶æ…‹ãŒãƒˆã‚°ãƒ«ã™ã‚‹ã‚ˆã†ãªå‹•ä½œã‚’å®Ÿç¾ã—ã¾ã™ã€‚

![](https://tva1.sinaimg.cn/large/007S8ZIlgy1ggbld6fenoj30ea05swes.jpg)

# Statefulã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã¨Statelessã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ

å®Ÿéš›ã«ã‚³ãƒ¼ãƒ‰ã‚’è§¦ã£ã¦ã„ãå‰ã«ã€Statefulã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã¨Statelessã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã«ã¤ã„ã¦ãŠã•ã‚‰ã„ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã«ã¯2ç¨®é¡ã‚ã‚Šã€ãã‚ŒãŒ `Stateful` ã¨ `Stateless` ã§ã™ã€‚

Statefulã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã¯çŠ¶æ…‹ã‚’æŒã¤ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ãªã©ã«å¿œã˜ã¦ä½•ã‹ã—ã‚‰çŠ¶æ…‹ãŒå¤‰åŒ–ã™ã‚‹ã“ã¨ãŒã‚ã‚‹ãªã‚‰ã€ãã‚Œã¯Statefulã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã§ã™ã€‚

Statelessã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã¯çŠ¶æ…‹ã‚’æŒã¡ã¾ã›ã‚“ã€‚ã¤ã¾ã‚Šã€ç”Ÿæˆã•ã‚Œã¦ã‹ã‚‰ç ´æ£„ã•ã‚Œã‚‹ã¾ã§ã®é–“ã€ä¿æœ‰ã—ã¦ã„ã‚‹å€¤ãŒä¸€åˆ‡å¤‰åŒ–ã—ã¾ã›ã‚“ã€‚ [`Icon`](https://api.flutter.dev/flutter/widgets/Icon-class.html) [`IconButton`](https://api.flutter.dev/flutter/material/IconButton-class.html) [`Text`](https://api.flutter.dev/flutter/widgets/Text-class.html) ãªã©ãŒStatelessã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®ä¸€ä¾‹ã§ã™ã€‚Statelessã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã¯ã€ [`StatelessWidget`](https://api.flutter.dev/flutter/widgets/StatelessWidget-class.html) ã‚¯ãƒ©ã‚¹ã®ã‚µãƒ–ã‚¯ãƒ©ã‚¹ã¨ã—ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚

Statefulã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®ä¾‹ã¨ã—ã¦ã¯ã€ [`Checkbox`](https://api.flutter.dev/flutter/material/Checkbox-class.html) [`Radio`](https://api.flutter.dev/flutter/material/Radio-class.html) [`Slider`](https://api.flutter.dev/flutter/material/Slider-class.html) [`InkWell`](https://api.flutter.dev/flutter/material/InkWell-class.html) [`Form`](https://api.flutter.dev/flutter/widgets/Form-class.html) [`TextField`](https://api.flutter.dev/flutter/material/TextField-class.html) ãªã© ãŒã‚ã‚Šã¾ã™ã€‚Statefulã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã¯ [`StatefulWidget`](https://api.flutter.dev/flutter/widgets/StatefulWidget-class.html) ã‚¯ãƒ©ã‚¹ã®ã‚µãƒ–ã‚¯ãƒ©ã‚¹ã¨ã—ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚

ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®çŠ¶æ…‹ã¯ã€ [`State`](https://api.flutter.dev/flutter/widgets/State-class.html) ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã‚ˆã£ã¦ä¿æŒã•ã‚Œã¾ã™ã€‚ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®è¡¨ç¾ã¨çŠ¶æ…‹ã¯åˆ¥ã€…ã®ã‚¯ãƒ©ã‚¹ã«ã‚ˆã£ã¦ç®¡ç†ã•ã‚Œã¦ã„ã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚

`State` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ã€çŠ¶æ…‹ã‚’è¡¨ã™ä½•ã‹ã—ã‚‰å¯å¤‰ãªå€¤ã‚’æŒã£ã¦ã„ã¾ã™ã€‚ä¾‹ãˆã°ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã«ãŠã‘ã‚‹ã€Œç¾åœ¨ã®å€¤ã€ã‚„ã€ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã«ãŠã‘ã‚‹ã€Œãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã€ãªã©ã®æƒ…å ±ãŒãã‚Œã«å½“ãŸã‚Šã¾ã™ã€‚

ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®çŠ¶æ…‹ãŒå¤‰æ›´ã•ã‚Œã‚‹ã¨ã€ `State` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ `setState()` ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™ã“ã¨ã«ã‚ˆã£ã¦ã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®å†æç”»ã‚’ä¾é ¼ã—ã¾ã™ã€‚

# Step 1ï¼šã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®çŠ¶æ…‹ã‚’ã©ã†ç®¡ç†ã™ã‚‹ã‹ã‚’æ±ºã‚ã‚‹

å®Ÿã¯ã€ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹æ–¹æ³•ã«ã¯é¸æŠè‚¢ãŒã„ãã¤ã‹ã‚ã‚Šã¾ã™ã€‚

ä»Šå›ã®ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã§ã¯ `FavoriteWidget` ã¨ã„ã†ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’ä½œã£ã¦ã€è‡ªåˆ†è‡ªèº«ã«çŠ¶æ…‹ã®ç®¡ç†ã‚’ã•ã›ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚

ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã¨çŠ¶æ…‹ã®åˆ†é›¢ã«ã¤ã„ã¦ã‚ˆã‚Šè©³ç´°ã«å­¦ã³ãŸã„å ´åˆã¯ã€å…¬å¼ã‚µã‚¤ãƒˆã® [Managing state](https://flutter.dev/docs/development/ui/interactive#managing-state) ã¨ã„ã†ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å‚ç…§ã™ã‚‹ã¨ã‚ˆã„ã§ã—ã‚‡ã†ã€‚ï¼ˆæœ¬ãƒ–ãƒ­ã‚°ã§ã®è§£èª¬è¨˜äº‹ã¯ [ã“ã¡ã‚‰](https://zenn.dev/ttskch/articles/3e2a80a44b08ee)ï¼‰

# Step 2ï¼š `StatefulWidget` ã‚’ç¶™æ‰¿ã—ãŸã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’ä½œã‚‹

ã¾ãšã¯ã€çŠ¶æ…‹ã‚’æŒã¤Statefulã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®ã‚¯ãƒ©ã‚¹ã‚’ä½œã‚Šã¾ã™ã€‚ `lib/main.dart` ã®æœ«å°¾ã«ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãè¶³ã—ã¾ã—ã‚‡ã†ã€‚

```dart
class FavoriteWidget extends StatefulWidget {
  @override
  _FavoriteWidgetState createState() => _FavoriteWidgetState();
}
```

`FavoriteWidget` ã‚¯ãƒ©ã‚¹ã¯è‡ªåˆ†ã®çŠ¶æ…‹ã‚’è‡ªåˆ†ã§ç®¡ç†ã—ã¾ã™ã€‚ãã®ãŸã‚ã«ã€ `State` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹ `createState()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã—ã¦ã„ã¾ã™ã€‚

`createState()` ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒãƒ“ãƒ«ãƒ‰ã•ã‚Œã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ã‚ˆã£ã¦å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ã“ã®ä¾‹ã§ã¯ã€ `createState()` ãƒ¡ã‚½ãƒƒãƒ‰ã¯ `_FavoriteWidgetState` ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¿”ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã§å®Ÿè£…ã—ã¾ã—ã‚‡ã†ã€‚

# Step 3ï¼š `State` ã‚’ç¶™æ‰¿ã—ãŸçŠ¶æ…‹ã‚¯ãƒ©ã‚¹ã‚’ä½œã‚‹

`FavoriteWidget` ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®çŠ¶æ…‹ã‚’ä¿æœ‰ã™ã‚‹ã®ãŒ `_FavoriteWidgetState` ã‚¯ãƒ©ã‚¹ã§ã™ã€‚

ä»Šå›ã¯ã€ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã—ãŸã¨ãã«ã¯

* è‡ªåˆ†ã¯ã™ã§ã«ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ ã—ã¦ã„ã‚‹çŠ¶æ…‹ï¼ˆã¨ã„ã†ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼‰
* è¡¨ç¤ºå†…å®¹ã¨ã—ã¦ã¯ã€èµ¤è‰²ã§å¡—ã‚Šæ½°ã•ã‚ŒãŸâ˜…ã‚¢ã‚¤ã‚³ãƒ³ã¨ã€ `41` ã¨ã„ã†æ•°å­—ï¼ˆãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ ã•ã‚Œã¦ã„ã‚‹æ•°ã‚’è¡¨ã—ã¦ã„ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼‰

ã¨ã„ã†çŠ¶æ…‹ã«ã—ãŸã„ã®ã§ã€ `lib/main.dart` ã®æœ«å°¾ã«ã²ã¨ã¾ãšä»¥ä¸‹ã®ã‚ˆã†ãªã‚¯ãƒ©ã‚¹å®šç¾©ã‚’è¿½è¨˜ã—ã¾ã—ã‚‡ã†ã€‚

```dart
class _FavoriteWidgetState extends State<FavoriteWidget> {
  bool _isFavorited = true;
  int _favoriteCount = 41;
}
```

ã•ã‚‰ã«ã€ã“ã®ã‚¯ãƒ©ã‚¹ã« `build()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã—ã¾ã™ã€‚ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã§ `FavoriteWidget` ã®å®Ÿéš›ã®ä¸­èº«ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

```diff
  class _FavoriteWidgetState extends State<FavoriteWidget> {
    bool _isFavorited = true;
    int _favoriteCount = 41;
+ 
+   @override
+   Widget build(BuildContext context) {
+     return Row(
+       mainAxisSize: MainAxisSize.min,
+       children: [
+         Container(
+           padding: EdgeInsets.all(0),
+           child: IconButton(
+             icon: (_isFavorited ? Icon(Icons.star) : Icon(Icons.star_border)),
+             color: Colors.red[500],
+             onPressed: _toggleFavorite,
+           ),
+         ),
+         SizedBox(
+           width: 18,
+           child: Container(
+             child: Text('$_favoriteCount'),
+           ),
+         ),
+       ],
+     );
+   }
  }
```

`Icon` ã§ã¯ãªã [`IconButton`](https://api.flutter.dev/flutter/material/IconButton-class.html) ã‚’ä½¿ã£ã¦ã„ã‚‹ç‚¹ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ `IconButton` ã¯ `onPressed` ã¨ã„ã†ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æŒã£ã¦ã„ã¦ã€ã‚¿ãƒƒãƒ—ã•ã‚ŒãŸã¨ãã«å®Ÿè¡Œã—ãŸã„å‡¦ç†ã‚’ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨ã—ã¦æ¸¡ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã“ã§ã¯ `_toggleFavorite` ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ¸¡ã—ã¦ã„ã¾ã™ã€‚ã§ã¯ã€æ¬¡ã«ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã—ã¾ã—ã‚‡ã†ã€‚

```diff
  class _FavoriteWidgetState extends State<FavoriteWidget> {
    bool _isFavorited = true;
    int _favoriteCount = 41;
  
+   void _toggleFavorite() {
+     setState(() {
+       if (_isFavorited) {
+         _favoriteCount -= 1;
+         _isFavorited = false;
+       } else {
+         _favoriteCount += 1;
+         _isFavorited = true;
+       }
+     });
+   }
+ 
    @override
    Widget build(BuildContext context) {
    // ...
```

`_toggleFavorite()` ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€ `setState()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã¦ã„ã¾ã™ã€‚

`setState()` ã‚’å‘¼ã³å‡ºã™ã¨ã„ã†è¡Œç‚ºã«ã¯ç‰¹åˆ¥ãªæ„å‘³ãŒã‚ã‚Šã¾ã™ã€‚å…ˆè¿°ã—ãŸã¨ãŠã‚Šã€ã“ã‚Œã«ã‚ˆã£ã¦ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®çŠ¶æ…‹ãŒå¤‰ã‚ã£ãŸã“ã¨ã‚’é€šçŸ¥ã—ã€ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®å†æç”»ã‚’ä¾é ¼ã—ã¦ã„ã‚‹ã®ã§ã™ã€‚

`setState()` ã«å¼•æ•°ã¨ã—ã¦æ¸¡ã—ã¦ã„ã‚‹ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãƒ¼ã®ä¸­ã§ã€ `_isFavorited` ãŠã‚ˆã³ `_favoriteCount` ã¨ã„ã†å¤‰æ•°ã®å€¤ã‚’æ›´æ–°ã—ã¦ã„ã¾ã™ã€‚

ã“ã†ã—ã¦ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒå†æç”»ã•ã‚Œã‚‹ã¨ã€Stateã‚¯ãƒ©ã‚¹ã® `build()` ãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã€

```
icon: (_isFavorited ? Icon(Icons.star) : Icon(Icons.star_border)),
```

ã“ã®éƒ¨åˆ†ã®æ¡ä»¶åˆ†å²ã«ã‚ˆã£ã¦ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®è¦‹ãŸç›®ãŒå¤‰åŒ–ã™ã‚‹ã¨ã„ã†ã‚ã‘ã§ã™ã€‚

# Step 4ï¼šä½œã£ãŸStatefulã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’ç”»é¢ã«ã¯ã‚è¾¼ã‚€

ã‚ã¨ã¯ä½œã£ãŸã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’å®Ÿéš›ã«ç”»é¢ã«ã¯ã‚è¾¼ã‚€ã ã‘ã§ã™ã€‚

`titleSection` ã‚’çµ„ã¿ç«‹ã¦ã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ã®ä»¥ä¸‹ã®ç®‡æ‰€ã‚’å·®ã—æ›¿ãˆã¾ã—ã‚‡ã†ã€‚

```diff
  class MyApp extends StatelessWidget {
    @override
    Widget build(BuildContext context) {
      Widget titleSection = Container(
        padding: const EdgeInsets.all(32),
        child: Row(
          children: [
            Expanded(
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  Container(
                    padding: const EdgeInsets.only(bottom: 8),
                    child: Text(
                      'Oeschinen Lake Campground',
                      style: TextStyle(
                        fontWeight: FontWeight.bold,
                      ),
                    ),
                  ),
                  Text(
                    'Kandersteg, Switzerland',
                    style: TextStyle(
                      color: Colors.grey[500],
                    ),
                  ),
                ],
              ),
            ),
-           Icon(
-             Icons.star,
-             color: Colors.red[500],
-           ),
-           Text('41'),
+           FavoriteWidget(),
          ],
        ),
      );

      // ...
```

ã“ã‚Œã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨çŠ¶æ…‹ãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹ã‚ˆã†ãªUIãŒå®Ÿè£…ã§ãã¾ã—ãŸğŸ‘

![](https://tva1.sinaimg.cn/large/007S8ZIlgy1ggbmp743lgg30ab0if0wt.gif)
