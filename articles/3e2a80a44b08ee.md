---
title: "[Flutterå…¥é–€ï¼ˆ6ï¼‰] å…¬å¼ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®ã‚¹ãƒ†ãƒƒãƒ—2ã®å¾ŒåŠï¼šManaging stateã‚’èª­ã‚“ã§ã¿ã‚‹"
emoji: "ğŸ’»"
type: "tech"
topics: ["flutter"]
published: true
published_at: 2020-07-08
---

:::message
ã“ã®è¨˜äº‹ã¯ã€2020-07-08ã«åˆ¥ã®ãƒ–ãƒ­ã‚°åª’ä½“ã«æŠ•ç¨¿ã—ãŸè¨˜äº‹ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã§ã™ã€‚
:::

Flutterã®å…¬å¼ã‚µã‚¤ãƒˆã« [ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«](https://flutter.dev/docs/reference/tutorials) ã¨ã—ã¦ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã†ã¡ã€2ã¤ç›®ã® [Adding interactivity to your Flutter app](https://flutter.dev/docs/development/ui/interactive) ã®ãƒšãƒ¼ã‚¸ã®å¾ŒåŠéƒ¨åˆ†ã«ã‚ã‚‹ [Managing state](https://flutter.dev/docs/development/ui/interactive#managing-state) ã®éƒ¨åˆ†ã‚’èª­ã‚“ã§ã€ãã®å†…å®¹ã‚’ã¾ã¨ã‚ã¦ã¿ã¾ã—ãŸã€‚

åŸæ–‡ã‚’è£œå®Œã™ã‚‹ã‚ˆã†ãªå½¢ã§æ´»ç”¨ã—ã¦ã„ãŸã ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚

# ã¯ã˜ã‚ã«

å…ˆã«ãƒã‚¤ãƒ³ãƒˆã‚’ã¾ã¨ã‚ã‚‹ã¨ã€ä»¥ä¸‹ã®ã¨ãŠã‚Šã€‚

* çŠ¶æ…‹ã®ç®¡ç†æ–¹æ³•ã«ã¯ã„ãã¤ã‹ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒã‚ã‚‹
* ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’ãƒ‡ã‚¶ã‚¤ãƒ³ã™ã‚‹éš›ã€ã©ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’ä½¿ã†ã‹ã¯ã‚ãªãŸæ¬¡ç¬¬
* è¿·ã†å ´åˆã¯ã€è¦ªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã§ç®¡ç†ã™ã‚‹æ–¹æ³•ã‹ã‚‰å§‹ã‚ã‚‹ã®ãŒãŠã™ã™ã‚

---

Statefulã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹æ–¹æ³•ã«ã¯ã„ãã¤ã‹ã®é¸æŠè‚¢ãŒã‚ã‚Šã€ã©ã®æ–¹æ³•ãŒé©åˆ‡ã‹ã¯çŠ¶æ³ã«ã‚ˆã‚‹ã€‚ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’ãƒ‡ã‚¶ã‚¤ãƒ³ã™ã‚‹éš›ã¯ã€ãã®ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒã©ã®ã‚ˆã†ã«ä½¿ã‚ã‚Œã‚‹ã“ã¨ã‚’æœŸå¾…ã™ã‚‹ã‹ã«ã‚ˆã£ã¦é©åˆ‡ã«ç®¡ç†æ–¹æ³•ã‚’é¸æŠã™ã‚‹ã¹ã—ã€‚

æœ€ã‚‚ä¸€èˆ¬çš„ãªç®¡ç†æ–¹æ³•ã¯ä»¥ä¸‹ã®3ã¤ã€‚

* [ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆè‡ªèº«ãŒè‡ªåˆ†ã®çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹æ–¹æ³•](#ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆè‡ªèº«ãŒè‡ªåˆ†ã®çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹æ–¹æ³•)
* [è¦ªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒå­ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹æ–¹æ³•](#è¦ªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒå­ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹æ–¹æ³•)
* [mix-and-matchã‚¢ãƒ—ãƒ­ãƒ¼ãƒ](#mix-and-matchã‚¢ãƒ—ãƒ­ãƒ¼ãƒ)

ã©ã®æ–¹æ³•ã‚’é¸æŠã™ã‚‹ã‹ã‚’æ±ºã‚ã‚‹éš›ã¯ã€ä»¥ä¸‹ã®åŸºæœ¬åŸå‰‡ã‚’å‚è€ƒã«ã™ã‚‹ã¨ã‚ˆã„ã€‚

* çŠ¶æ…‹ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã«é–¢ã™ã‚‹ã‚‚ã®ã§ã‚ã‚Œã°ã€è¦ªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã«ç®¡ç†ã—ã¦ã‚‚ã‚‰ã†ã®ãŒã‚ˆã„ï¼ˆä¾‹ï¼šãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®é¸æŠçŠ¶æ…‹ã€ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ä½ç½®æƒ…å ±ãªã©ï¼‰
* çŠ¶æ…‹ãŒå˜ç´”ã«è¦‹ãŸç›®ã«é–¢ã™ã‚‹ã‚‚ã®ã§ã‚ã‚Œã°ã€ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆè‡ªèº«ã§ç®¡ç†ã™ã‚‹ã®ãŒã‚ˆã„ï¼ˆä¾‹ï¼šã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãªã©ï¼‰
* è¿·ã†å ´åˆã¯ã€è¦ªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã«ç®¡ç†ã—ã¦ã‚‚ã‚‰ã†æ–¹æ³•ã‹ã‚‰å§‹ã‚ã‚‹ã¨ã‚ˆã„

ä»¥ä¸‹ã€ç°¡å˜ãªå®Ÿä¾‹ã‚’ç”¨ã„ã¦3ã¤ã®ç®¡ç†æ–¹æ³•ã‚’æ¯”è¼ƒã—ã¦ã¿ã‚‹ã€‚ä¾‹ã¨ã™ã‚‹ä»•æ§˜ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã€‚

* ãã‚Œãã‚Œã®ç®¡ç†æ–¹æ³•ã”ã¨ã«ã€ `TapboxA` `TapboxB` `TapboxC` ã¨ã„ã†ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’ç”¨æ„ã™ã‚‹
* ã„ãšã‚Œã‚‚ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ `_active` ã¨ã„ã†çœŸå½å€¤ãŒãƒˆã‚°ãƒ«ã™ã‚‹æ©Ÿèƒ½ã‚’æŒã¡ã€ `_active` ã®çŠ¶æ…‹ã«å¿œã˜ã¦è¦‹ãŸç›®ãŒä¸‹å›³ã®ã‚ˆã†ã«ã‚°ãƒªãƒ¼ãƒ³ï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–ï¼‰ã¨ã‚°ãƒ¬ãƒ¼ï¼ˆéã‚¢ã‚¯ãƒ†ã‚£ãƒ–ï¼‰ã§å¤‰åŒ–ã™ã‚‹

![](https://tva1.sinaimg.cn/large/007S8ZIlgy1ggjp031x5fj305k05kmx4.jpg) ![](https://tva1.sinaimg.cn/large/007S8ZIlgy1ggjp0a23xjj305k05kwef.jpg)

ãªãŠã€ã“ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã¯ `Container` ã‚’ã‚¿ãƒƒãƒ—å¯èƒ½ã«ã™ã‚‹ãŸã‚ã« [`GestureDetector`](https://api.flutter.dev/flutter/widgets/GestureDetector-class.html) ã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹ã€‚

> **è‘—è€…æ³¨**  
> å®Ÿéš›ã«ã‚³ãƒ¼ãƒ‰ã‚’å‹•ã‹ã—ãªãŒã‚‰èª­ã¿é€²ã‚ãŸã„å ´åˆã¯ã€ `flutter create managing_state` ãªã©ã¨ã—ã¦é››å½¢ã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¦ãŠã„ã¦ãã ã•ã„ã€‚ `managing_state/lib/main.dart` ã®ä¸­èº«ã‚’æ›¸ãæ›ãˆã¦ã„ãã“ã¨ã§ã€å®Ÿéš›ã«ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’å‹•ã‹ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

# ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆè‡ªèº«ãŒè‡ªåˆ†ã®çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹æ–¹æ³•

ä¾‹ãˆã° `ListView` ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã¯ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã‚µã‚¤ã‚ºã«å¯¾ã—ã¦è¡¨ç¤ºé ˜åŸŸãŒå°ã•ã™ãã‚‹å ´åˆã€è‡ªå‹•çš„ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ãªçŠ¶æ…‹ã¨ã—ã¦ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã€ç¾åœ¨ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ãªã©ã®çŠ¶æ…‹ã‚‚ `ListView` è‡ªèº«ãŒç®¡ç†ã™ã‚‹ã€‚

`ListView` ã‚’ä½¿ç”¨ã™ã‚‹é–‹ç™ºè€…ã¯ã€ `ListView` ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã«é–¢ã™ã‚‹æŒ¯ã‚‹èˆã„ã‚’ã‚ã–ã‚ã–è‡ªåˆ†ã§ç®¡ç†ã—ãŸã„ã¨ã¯æ€ã‚ãªã„ã®ã§ã€ã“ã®è¨­è¨ˆã¯æ­£ã—ã„ã¨è¨€ãˆã‚‹ã€‚

ã“ã“ã§ç´¹ä»‹ã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã“ã‚Œã¨åŒã˜ã§ã€ä»¥ä¸‹ã«ä¾‹ç¤ºã™ã‚‹ `_TapboxAState` ã‚¯ãƒ©ã‚¹ã¯ã€

* `TapboxA` ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹
* `_active` ã¨ã„ã†çœŸå½å€¤ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æŒã¡ã€ã“ã®å€¤ãŒãƒœãƒƒã‚¯ã‚¹ã®è‰²ã‚’æ±ºå®šã™ã‚‹
* `_handleTap()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒã¡ã€ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒ `_active` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å€¤ã®å¤‰æ›´ãŠã‚ˆã³ `setState()` ã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ã“ã¨ã«ã‚ˆã‚‹UIã®å†æç”»ã‚’è¡Œã†
* ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã«ã¤ã„ã¦ã®ã™ã¹ã¦ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªæ“ä½œã‚’å®Ÿè£…ã—ã¦ã„ã‚‹

## ã‚³ãƒ¼ãƒ‰ä¾‹

```dart
// lib/main.dart
import 'package:flutter/material.dart';

void main() {
  runApp(MyApp());
}

class MyApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Flutter Demo',
      home: Scaffold(
        appBar: AppBar(
          title: Text('Flutter Demo'),
        ),
        body: Center(
          child: TapboxA(),
        ),
      ),
    );
  }
}

class TapboxA extends StatefulWidget {
  TapboxA({Key key}) : super(key: key);

  @override
  _TapboxAState createState() => _TapboxAState();
}

class _TapboxAState extends State<TapboxA> {
  bool _active = false;

  void _handleTap() {
    setState(() {
      _active = !_active;
    });
  }

  Widget build(BuildContext context) {
    return GestureDetector(
      onTap: _handleTap,
      child: Container(
        child: Center(
          child: Text(
            _active ? 'Active' : 'Inactive',
            style: TextStyle(fontSize: 32.0, color: Colors.white),
          ),
        ),
        width: 200.0,
        height: 200.0,
        decoration: BoxDecoration(
          color: _active ? Colors.lightGreen[700] : Colors.grey[600],
        ),
      ),
    );
  }
}
```

# è¦ªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒå­ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹æ–¹æ³•

è¦ªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒå­ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®çŠ¶æ…‹ã‚’ç®¡ç†ã—ã¦ã€å¤‰æ›´ãŒã‚ã‚Œã°å­ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã«ä¼ãˆã‚‹ã¨ã„ã†è¨­è¨ˆãŒåˆç†æ€§ã‚’æŒã¤çŠ¶æ³ã¯å¤šã„ã€‚

ä¾‹ãˆã°ã€ [`IconButton`](https://api.flutter.dev/flutter/material/IconButton-class.html) ã¯ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¿ãƒƒãƒ—å¯èƒ½ãªãƒœã‚¿ãƒ³ã¨ã—ã¦ä½¿ç”¨ã§ãã‚‹ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã ãŒã€ `IconButton` è‡ªä½“ã¯Statelessã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã§ã‚ã‚‹ã€‚ `IconButton` ã®è¦ªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒã€Œãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã‹ã©ã†ã‹ã€ã‚’çŸ¥ã‚Šã€é©åˆ‡ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã€‚

ä»¥ä¸‹ã®ä¾‹ã§ã¯ã€ `TabboxB` ã¯è‡ªèº«ã®çŠ¶æ…‹ã‚’è¦ªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã«å¯¾ã—ã¦é–‹ç¤ºï¼ˆã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ä½¿ã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ï¼‰ã—ã¦ãŠã‚Šã€ `TapboxB` è‡ªä½“ã¯ä½•ã‚‰çŠ¶æ…‹ã‚’ç®¡ç†ã—ã¦ã„ãªã„ã€‚ï¼ˆStatelessã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã§ã‚ã‚‹ï¼‰

ä¸€æ–¹ã§ `ParentWidgetState` ã‚¯ãƒ©ã‚¹ã¯ã€

* `_active` ã«ã‚ˆã£ã¦ `TapboxB` ã®çŠ¶æ…‹ã‚’ç®¡ç†ã—ã¦ã„ã‚‹
* `_handleTapboxChanged()` ã¨ã„ã†ã€ãƒœãƒƒã‚¯ã‚¹ãŒã‚¿ãƒƒãƒ—ã•ã‚ŒãŸã¨ãã«å®Ÿè¡Œã•ã‚Œã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒã£ã¦ã„ã‚‹
* çŠ¶æ…‹ãŒå¤‰åŒ–ã—ãŸã‚‰ã€ `setState()` ã‚’å‘¼ã³å‡ºã—ã¦UIã‚’æ›´æ–°ã™ã‚‹

ã¾ãŸ `TapboxB` ã‚¯ãƒ©ã‚¹ã¯ã€

* `StatelessWidget` ã‚¯ãƒ©ã‚¹ã‚’ç¶™æ‰¿ã—ã¦ãŠã‚Šã€è‡ªèº«ã¯çŠ¶æ…‹ã‚’æŒãŸãªã„ï¼ˆè¦ªãŒç®¡ç†ã—ã¦ãã‚Œã‚‹ã‹ã‚‰ï¼‰
* ã‚¿ãƒƒãƒ—ã‚’æ¤œçŸ¥ã—ãŸã‚‰ã€è¦ªã«ãã®ã“ã¨ã‚’é€šçŸ¥ã™ã‚‹

## ã‚³ãƒ¼ãƒ‰ä¾‹

```dart
// lib/main.dart
import 'package:flutter/material.dart';

void main() {
  runApp(MyApp());
}

class MyApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Flutter Demo',
      home: Scaffold(
        appBar: AppBar(
          title: Text('Flutter Demo'),
        ),
        body: Center(
          child: ParentWidget(),
        ),
      ),
    );
  }
}

class ParentWidget extends StatefulWidget {
  @override
  _ParentWidgetState createState() => _ParentWidgetState();
}

class _ParentWidgetState extends State<ParentWidget> {
  bool _active = false;

  void _handleTapboxChanged(bool newValue) {
    setState(() {
      _active = newValue;
    });
  }

  @override
  Widget build(BuildContext context) {
    return Container(
      child: TapboxB(
        active: _active,
        onChanged: _handleTapboxChanged,
      ),
    );
  }
}

class TapboxB extends StatelessWidget {
  TapboxB({Key key, this.active: false, @required this.onChanged})
      : super(key: key);

  final bool active;
  final ValueChanged<bool> onChanged;

  void _handleTap() {
    onChanged(!active);
  }

  Widget build(BuildContext context) {
    return GestureDetector(
      onTap: _handleTap,
      child: Container(
        child: Center(
          child: Text(
            active ? 'Active' : 'Inactive',
            style: TextStyle(fontSize: 32.0, color: Colors.white),
          ),
        ),
        width: 200.0,
        height: 200.0,
        decoration: BoxDecoration(
          color: active ? Colors.lightGreen[700] : Colors.grey[600],
        ),
      ),
    );
  }
}
```

# mix-and-matchã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

mix-and-matchã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¨å‘¼ã°ã‚Œã‚‹æ‰‹æ³•ãŒæœ€é©ãªå ´åˆã‚‚ã‚ã‚Šãˆã‚‹ã€‚ä¾‹ãˆã°ã€ã‚ã‚‹Statefulã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒ

ã“ã“ã§ç´¹ä»‹ã™ã‚‹ `TapboxC` ã®ä¾‹ã§ã¯ã€ä¸‹å›³ã®ã‚ˆã†ã«ã€ã‚¿ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ï¼ˆæŠ¼ã—è¾¼ã¿ï¼‰ä¸­ã¯ãƒœãƒƒã‚¯ã‚¹ã«æ¿ƒã„ç·‘è‰²ã®æ ç·šã‚’è¡¨ç¤ºã—ã€ã‚¿ãƒƒãƒ—ã‚¢ãƒƒãƒ—ã™ã‚‹ã¨ï¼ˆæŠ¼ã—è¾¼ã¿ã‚’é›¢ã™ã¨ï¼‰æ ç·šã‚’æ¶ˆå»ã—ã¦ãƒœãƒƒã‚¯ã‚¹ã®è‰²ã‚’å¤‰æ›´ã™ã‚‹ã‚ˆã†ãªä»•æ§˜ã‚’è€ƒãˆã‚‹ã€‚

![](https://tva1.sinaimg.cn/large/007S8ZIlgy1ggjqas8n3zg30aa0ig0tf.gif)

`TapboxC` ã¯ `_active` ã¨ã„ã†çŠ¶æ…‹ã¯è¦ªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã«å¯¾ã—ã¦é–‹ç¤ºã™ã‚‹ãŒã€ `_highlight` ã¨ã„ã†åˆ¥ã®çŠ¶æ…‹ï¼ˆæ ç·šã®è¡¨ç¤ºã‚’å¸ã‚‹çŠ¶æ…‹ï¼‰ã¯è‡ªåˆ†è‡ªèº«ã§ç®¡ç†ã™ã‚‹ã€‚ã“ã‚ŒãŒmix-and-matchã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã‚ã‚‹ã€‚

ã“ã®ä¾‹ã§ã¯ã€ `_ParentWidgetState` ã‚¯ãƒ©ã‚¹ã¨ `_TapboxCState` ã‚¯ãƒ©ã‚¹ã¨ã„ã†2ã¤ã®Stateã‚¯ãƒ©ã‚¹ãŒç™»å ´ã™ã‚‹ã€‚

`_ParentWidgetState` ã‚¯ãƒ©ã‚¹ã¯ã€

* `_active` çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹
* `_handleTapboxChanged()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒã¡ã€ãƒœãƒƒã‚¯ã‚¹ãŒã‚¿ãƒƒãƒ—ã•ã‚ŒãŸã¨ãã«ãã‚ŒãŒå‘¼ã°ã‚Œã‚‹
* ã‚¿ãƒƒãƒ—ãŒç™ºç”Ÿã—ã¦ `_active` çŠ¶æ…‹ãŒå¤‰åŒ–ã™ã‚‹ã¨ã€ `setState()` ã‚’èª­ã‚“ã§UIã‚’æ›´æ–°ã™ã‚‹

`_TapboxCState` ã‚¯ãƒ©ã‚¹ã¯ã€

* `_highlight` çŠ¶æ…‹ã‚’ç®¡ç†ã™
* `GestureDetector` ã‚¯ãƒ©ã‚¹ã‚’ä½¿ã£ã¦ã‚¿ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç›£è¦–ã—ã€ã‚¿ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã•ã‚ŒãŸã‚‰æ ç·šã‚’è¡¨ç¤ºã€ã‚¿ãƒƒãƒ—ã‚¢ãƒƒãƒ—ã•ã‚ŒãŸã‚‰æ ç·šã‚’æ¶ˆå»ã™ã‚‹
* ã‚¿ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã€ã‚¿ãƒƒãƒ—ã‚¢ãƒƒãƒ—ã€ã‚¿ãƒƒãƒ—ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã™ã‚‹ã‹ã€ `_highlight` çŠ¶æ…‹ãŒå¤‰åŒ–ã™ã‚‹ã‹ã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã€ `setState()` ã‚’èª­ã‚“ã§UIã‚’æ›´æ–°ã™ã‚‹
* ã‚¿ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿæ™‚ã€ [`widget`](https://api.flutter.dev/flutter/widgets/State/widget.html) ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ä½¿ã£ã¦è‡ªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®çŠ¶æ…‹ã‚’è¦ªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã«ä¼ãˆã‚‹

## ã‚³ãƒ¼ãƒ‰ä¾‹

```dart
// lib/main.dart
import 'package:flutter/material.dart';

void main() {
  runApp(MyApp());
}

class MyApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Flutter Demo',
      home: Scaffold(
        appBar: AppBar(
          title: Text('Flutter Demo'),
        ),
        body: Center(
          child: ParentWidget(),
        ),
      ),
    );
  }
}

class ParentWidget extends StatefulWidget {
  @override
  _ParentWidgetState createState() => _ParentWidgetState();
}

class _ParentWidgetState extends State<ParentWidget> {
  bool _active = false;

  void _handleTapboxChanged(bool newValue) {
    setState(() {
      _active = newValue;
    });
  }

  @override
  Widget build(BuildContext context) {
    return Container(
      child: TapboxC(
        active: _active,
        onChanged: _handleTapboxChanged,
      ),
    );
  }
}

class TapboxC extends StatefulWidget {
  TapboxC({Key key, this.active: false, @required this.onChanged})
      : super(key: key);

  final bool active;
  final ValueChanged<bool> onChanged;

  _TapboxCState createState() => _TapboxCState();
}

class _TapboxCState extends State<TapboxC> {
  bool _highlight = false;

  void _handleTapDown(TapDownDetails details) {
    setState(() {
      _highlight = true;
    });
  }

  void _handleTapUp(TapUpDetails details) {
    setState(() {
      _highlight = false;
    });
  }

  void _handleTapCancel() {
    setState(() {
      _highlight = false;
    });
  }

  void _handleTap() {
    widget.onChanged(!widget.active);
  }

  Widget build(BuildContext context) {
    // This example adds a green border on tap down.
    // On tap up, the square changes to the opposite state.
    return GestureDetector(
      onTapDown: _handleTapDown, // Handle the tap events in the order that
      onTapUp: _handleTapUp, // they occur: down, up, tap, cancel
      onTap: _handleTap,
      onTapCancel: _handleTapCancel,
      child: Container(
        child: Center(
          child: Text(widget.active ? 'Active' : 'Inactive',
              style: TextStyle(fontSize: 32.0, color: Colors.white)),
        ),
        width: 200.0,
        height: 200.0,
        decoration: BoxDecoration(
          color: widget.active ? Colors.lightGreen[700] : Colors.grey[600],
          border: _highlight
              ? Border.all(
                  color: Colors.teal[700],
                  width: 10.0,
                )
              : null,
        ),
      ),
    );
  }
}
```

ã“ã®å®Ÿè£…ä¾‹ã¨ã¯é€†ã«ã€ `_active` çŠ¶æ…‹ã‚’è‡ªèº«ã§ç®¡ç†ã—ã¦ã€ `_hightlight` çŠ¶æ…‹ã‚’è¦ªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã«é–‹ç¤ºã™ã‚‹æ–¹æ³•ã‚‚è€ƒãˆã‚‰ã‚Œã‚‹ãŒã€ç›´æ„Ÿçš„ã§ã¯ãªã„ã€‚ã‚¿ãƒƒãƒ—ãƒœãƒƒã‚¯ã‚¹ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’åˆ©ç”¨ã™ã‚‹é–‹ç™ºè€…ã®ã“ã¨ã‚’è€ƒãˆã‚Œã°ã€å½¼ã‚‰ã¯ãƒœãƒƒã‚¯ã‚¹ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‹ã©ã†ã‹ã«é–¢å¿ƒã¯ã‚ã‚‹ãŒã€æ ç·šãŒã©ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‹ã«ã¯é–¢å¿ƒãŒãªã„ã¯ãšã ã‹ã‚‰ã ã€‚ãã†ã§ã‚ã‚Œã°ã€æ ç·šã®è¡¨ç¤ºåˆ¶å¾¡ã¯ã‚¿ãƒƒãƒ—ãƒœãƒƒã‚¯ã‚¹è‡ªèº«ãŒç®¡ç†ã—ã¦ãã‚‹ã»ã†ãŒã‚ˆã„ã ã‚ã†ã€‚
