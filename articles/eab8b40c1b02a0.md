---
title: "GitHub Actionsã§ç‰¹å®šã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã‚ˆã‚‹ã‚¨ãƒ©ãƒ¼ã®ã¿ã‚’ç„¡è¦–ã™ã‚‹"
emoji: "ğŸ¡"
type: "tech"
topics: ["githubactions"]
published: true
---

[git-pr-release](https://github.com/x-motemen/git-pr-release) ãŒãƒªãƒªãƒ¼ã‚¹ã™ã¹ãPRãŒ1ã¤ã‚‚ãªã„ã¨ãã«ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã®ã‚’CIã§ã¯ç„¡è¦–ã—ãŸãã¦ã€æ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ãŒ `No pull requests to be released` ã‚’å«ã‚€å ´åˆã®ã¿ã‚¨ãƒ©ãƒ¼ã‚’ç„¡è¦–ã™ã‚‹ã€ã¨ã„ã†å¯¾å¿œã‚’ã—ãŸã®ã§ã™ãŒã€ãˆã‚‰ã„è‹¦åŠ´ã—ãŸã®ã§ã‚„ã‚Šæ–¹ã‚’ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™ğŸ™„

# æœ€çµ‚çš„ãªè¨­å®šå†…å®¹

```yaml
# .github/workflows/ci.yaml

name: CI

on: push

jobs:
  git-pr-release:
    if: ${{ github.ref == 'refs/heads/main' }}
    needs: test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - uses: ruby/setup-ruby@v1
        with:
          ruby-version: 3.1
      - run: gem install -N git-pr-release
      - id: git-pr-release
        env:
          GIT_PR_RELEASE_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GIT_PR_RELEASE_BRANCH_PRODUCTION: release
          GIT_PR_RELEASE_BRANCH_STAGING: main
        run: |
          EOF=$(dd if=/dev/urandom bs=15 count=1 status=none | base64)
          echo "error<<$EOF" >> $GITHUB_OUTPUT
          git-pr-release --no-fetch 2>> $GITHUB_OUTPUT || true
          echo "$EOF" >> $GITHUB_OUTPUT
        continue-on-error: true
      - if: ${{ steps.git-pr-release.outputs.error != '' && !contains(steps.git-pr-release.outputs.error, 'No pull requests to be released') }}
        run: |
          echo '::error ::git-pr-release failed with "${{ steps.git-pr-release.outputs.error }}"'
          exit 1
```

ã“ã‚“ãªæ„Ÿã˜ã§ã§ãã¾ã—ãŸã€‚

```
run: |
  EOF=$(dd if=/dev/urandom bs=15 count=1 status=none | base64)
  echo "error<<$EOF" >> $GITHUB_OUTPUT
  git-pr-release --no-fetch 2>> $GITHUB_OUTPUT || true
  echo "$EOF" >> $GITHUB_OUTPUT
```

ã§ã€`git-pr-release --no-fetch` ã®æ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ã‚’ **æ”¹è¡Œæ–‡å­—ã‚‚å«ã‚ã¦** `$GITHUB_OUTPUT` ã«æ¸¡ã—ã¦ã„ã¾ã™ã€‚

```
continue-on-error: true
```

ã«ã‚ˆã£ã¦ã€`git-pr-release --no-fetch` ã®çµ‚äº†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒã‚¨ãƒ©ãƒ¼ã§ã‚ã£ã¦ã‚‚ã‚¸ãƒ§ãƒ–ã‚’ç¶šè¡Œã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

ãã®ä¸Šã§ã€

```
- if: ${{ steps.git-pr-release.outputs.error != '' && !contains(steps.git-pr-release.outputs.error, 'No pull requests to be released') }}
  run: |
    echo '::error ::git-pr-release failed with "${{ steps.git-pr-release.outputs.error }}"'
    exit 1
```

ã§ã€**æ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ã®å†…å®¹ãŒç©ºã§ãªãã€ã‹ã¤ `No pull requests to be released` ã‚’å«ã‚€å ´åˆã®ã¿** ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’åã„ã¦CIã‚’failã•ã›ã¦ã„ã¾ã™ã€‚

# å‚è€ƒ

* [Workflow syntax for GitHub Actions - GitHub Docs `#jobsjob_idstepscontinue-on-error`](https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idstepscontinue-on-error)
* [How to fail a job in Github Actions? - Stack Overflow `#answer-74229789`](https://stackoverflow.com/questions/57903836/how-to-fail-a-job-in-github-actions#answer-74229789)
* [Workflow commands for GitHub Actions - GitHub Docs `#example-creating-an-annotation-for-an-error`](https://docs.github.com/en/actions/using-workflows/workflow-commands-for-github-actions#example-creating-an-annotation-for-an-error)
* [Capture stderr in GitHub Actions - Stack Overflow `#answer-65044849`](https://stackoverflow.com/questions/65033969/capture-stderr-in-github-actions#answer-65044849)
* [GitHub Actions ã§è¤‡æ•°è¡Œã®æ–‡å­—åˆ—ã‚’ output ã«ã‚»ãƒƒãƒˆã™ã‚‹æ–¹æ³• | gotohayato.com `#æ–¹æ³•-b-åŒºåˆ‡ã‚Šæ–‡å­—ã‚’ä½¿ã†`](https://gotohayato.com/content/558/#%E6%96%B9%E6%B3%95-b-%E5%8C%BA%E5%88%87%E3%82%8A%E6%96%87%E5%AD%97%E3%82%92%E4%BD%BF%E3%81%86)
* [Workflow commands for GitHub Actions - GitHub Docs `#example-of-a-multiline-string`](https://docs.github.com/en/actions/using-workflows/workflow-commands-for-github-actions#example-of-a-multiline-string)
