---
title: "symfony/monolog-bundleã‚’å…¥ã‚Œã¦ã„ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç’°å¢ƒã§å‹•ã‹ãªã‹ã£ãŸè©±"
emoji: "ğŸ»"
type: "tech"
topics: ["php", "symfony"]
published: true
published_at: 2020-04-10
---

:::message
ã“ã®è¨˜äº‹ã¯ã€2020-04-10ã«åˆ¥ã®ãƒ–ãƒ­ã‚°åª’ä½“ã«æŠ•ç¨¿ã—ãŸè¨˜äº‹ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã§ã™ã€‚
:::

åƒ•ãŒSymfonyãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚‹ã¨ãã«æ¯å›ä½¿ã£ã¦ã„ã‚‹ [ttskch/symfony-micro-skeleton](https://github.com/ttskch/symfony-micro-skeleton) ã¨ã„ã†ã‚¤ã‚«ã—ãŸã‚¹ã‚±ãƒ«ãƒˆãƒ³ãŒã‚ã‚‹ã‚“ã§ã™ãŒã€ã“ã‚Œã‚’ä½¿ã£ã¦ä½œã£ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’Herokuã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã‚‰

```
PHP Fatal error:  Uncaught Error: Class 'Symfony\Component\Console\ConsoleEvents' not found in /path/to/vendor/symfony/monolog-bridge/Handler/ConsoleHandler.php:139
```

ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã—ã¾ã„ã¾ã—ãŸã€‚åŸå› ã¨è§£æ±ºæ–¹æ³•ãªã©ã‚’ãƒ¡ãƒ¢ã«æ®‹ã—ã¦ãŠãã¾ã™ã€‚

# ãã‚‚ãã‚‚Herokuã§Symfonyã‚’å‹•ã‹ã™ã¨ãã®æ³¨æ„ç‚¹

Herokuã§PHPãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒãƒ“ãƒ«ãƒ‰ã•ã‚Œã‚‹éš›ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒãƒ³ãƒ‰ã¯

```
composer install --no-dev --prefer-dist --optimize-autoloader --no-interaction
```

ã¨ãªã£ã¦ã„ã¦ã€ `--no-dev` ãŒä»˜ã„ã¦ã„ã‚‹ã®ã§ `require-dev` ã§ä¾å­˜ã—ã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã›ã‚“ã€‚ï¼ˆ[å…¬å¼æƒ…å ±](https://devcenter.heroku.com/articles/php-support#build-behavior)ï¼‰

ãªã®ã§ã€Symfonyãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ›ã‚¹ãƒˆã™ã‚‹å ´åˆã¯ã€ç’°å¢ƒå¤‰æ•°ã« `APP_ENV=prod` ã‚’æ˜ç¤ºçš„ã«ã‚»ãƒƒãƒˆã—ã¦ãŠã‹ãªã„ã¨ã€ `require-dev` ãªã‚¯ãƒ©ã‚¹ãŒè‰²ã€…ã¨Not foundã«ãªã£ã¦ã—ã¾ã£ã¦å‹•ä½œã—ã¾ã›ã‚“ã€‚

# symfony/monolog-bundleã®ç½ ï¼Ÿ

ä»Šå›èµ·ã“ã£ãŸã®ã¯ã€

1. symfony/monolog-bundleãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¦
2. Symfony Recipeã«ã‚ˆã£ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸ [ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã® `prod/monolog.yaml`](https://github.com/symfony/recipes/blob/2de05e19f916c8841102f2a35f0dc08dbac219ed/symfony/monolog-bundle/3.3/config/packages/prod/monolog.yaml) ãŒé…ç½®ã•ã‚Œã¦ã„ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’
3. Herokuã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ `APP_ENV=prod` ã‚’ã‚»ãƒƒãƒˆã—ãŸã‚‰
4. `PHP Fatal error:  Uncaught Error: Class 'Symfony\Component\Console\ConsoleEvents' not found in /path/to/vendor/symfony/monolog-bridge/Handler/ConsoleHandler.php:139` ã«ãªã£ãŸ

ã¨ã„ã†ã“ã¨ã§ã™ã€‚

ã‚³ãƒ¼ãƒ‰ã‚’è¿½ã£ã¦ã¿ã‚‹ã¨ã€

1. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã® `prod/monolog.yaml` ã§ [`console` ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãŒä½¿ã‚ã‚Œã¦ã„ã‚‹](https://github.com/symfony/recipes/blob/2de05e19f916c8841102f2a35f0dc08dbac219ed/symfony/monolog-bundle/3.3/config/packages/prod/monolog.yaml#L14)
2. ãã—ã¦ã€symfony/monolog-bridgeã® `ConsoleHandler` ã‚¯ãƒ©ã‚¹ã¯ã€[symfony/consoleã®å„ç¨®ã‚¯ãƒ©ã‚¹ã«ä¾å­˜ã—ã¦ã„ã‚‹](https://github.com/symfony/monolog-bridge/blob/fd9750c732596742ee4f890a0a236881aad26c11/Handler/ConsoleHandler.php#L19-L23)
3. ã—ã‹ã—ã€symfony/monolog-bundleã¯symfony/consoleã« [`require-dev` ã§ã—ã‹ä¾å­˜ã—ã¦ã„ãªã„](https://github.com/symfony/monolog-bundle/blob/72e798ccdcfd277a6bc88e934b43f618732e3561/composer.json#L28)
4. ãªã®ã§ã€symfony/monolog-bundleã‚’requireã—ãŸã ã‘ã®ã‚¢ãƒ—ãƒªã ã¨ã€ `composer install --no-dev` ã‹ã¤ `APP_ENV=prod` ã®ç’°å¢ƒã«ãŠã„ã¦symfony/consoleã®å„ç¨®ã‚¯ãƒ©ã‚¹ãŒNot foundã«ãªã£ã¦ã—ã¾ã†

ã¨ã„ã†çŠ¶æ³ã®ã‚ˆã†ã§ã—ãŸğŸ¤”

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã® `prod/monolog.yaml` ã§ `console` ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãŒä½¿ã‚ã‚Œã¦ã„ã‚‹ã“ã¨ãŒé–“é•ã„ãªæ°—ãŒã™ã‚‹ã®ã§ã€ã¨ã‚Šã‚ãˆãšsymfony/recipesã«issueã‚’ç«‹ã¦ã¦ã¿ã¾ã—ãŸã€‚åå¿œã‚’å¾…ã¡ã¾ã™ã€‚

<https://github.com/symfony/recipes/issues/752>

# è§£æ±ºç­–

å½“ãŸã‚Šå‰ã§ã™ãŒã€ä»¥ä¸‹ã®ã‚ˆã†ã« `config/packages/prod/monolog.yaml` ã§ `console` ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’ä½¿ã‚ãªã„ã‚ˆã†ã«ã—ã¦ãŠã‘ã°ã¨ã‚Šã‚ãˆãšã‚¨ãƒ©ãƒ¼ã«ã¯ãªã‚Šã¾ã›ã‚“ã€‚

```diff
# config/packages/prod/monolog.yaml

-         console:
-             type: console
-             process_psr_3_messages: false
-             channels: ["!event", "!doctrine"]
+ #        console:
+ #            type: console
+ #            process_psr_3_messages: false
+ #            channels: ["!event", "!doctrine"]
```

ttskch/symfony-micro-skeletonã§ã‚‚ã¨ã‚Šã‚ãˆãš[åŒæ§˜ã®å¯¾å‡¦ã‚’ã—ã¦ã‚ã‚Šã¾ã™ã€‚](https://github.com/ttskch/symfony-micro-skeleton/commit/3eda8ae7d7cc1593cef0aa1b16597f269bcc4676)

> æœ¬å®¶ã®issueã§ä½•ã‹åˆ¥è§£ãŒç¤ºã•ã‚ŒãŸã‚‰ãã‚Œã«åˆã‚ã›ãŸå¯¾å¿œã‚’ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚

# ã¾ã¨ã‚

* symfony/monolog-bundleã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼†ãƒ¬ã‚·ãƒ”ã§monolog.yamlã‚’ä½œæˆã—ãŸã¾ã¾ã ã¨ã€ `composer install --no-dev` ã‹ã¤ `APP_ENV=prod` ãªç’°å¢ƒã§ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ã«ãªã£ãŸ
    * `PHP Fatal error:  Uncaught Error: Class 'Symfony\Component\Console\ConsoleEvents' not found in /path/to/vendor/symfony/monolog-bridge/Handler/ConsoleHandler.php:139`
* Symfonyã‚¢ãƒ—ãƒªã‚’Herokuã§ãƒ›ã‚¹ãƒˆã—ã¦ã„ã‚‹å ´åˆã«èµ·ã“ã‚Šã‚„ã™ã„ã®ã§ãŠæ°—ã‚’ã¤ã‘ã¦
* `console` ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’ä½¿ã‚ãªã„ã‚ˆã†ã« `prod/monolog.yaml` ã‚’ä¿®æ­£ã™ã‚Œã°ã¨ã‚Šã‚ãˆãšç›´ã‚‹
* <https://github.com/symfony/recipes/issues/752> ã®åå¿œã‚’å¾…ã¤
