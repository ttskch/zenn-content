---
title: "[Symfony] UniqueEntityã§è¤‡åˆãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚’è¨­å®šã—ãŸéš›ã«å¯¾è±¡ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã™ã¹ã¦ã«ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹æ–¹æ³•"
emoji: "ğŸ»"
type: "tech"
topics: ["php", "symfony", "doctrine"]
published: true
published_at: 2020-12-09
---

:::message
ã“ã®è¨˜äº‹ã¯ã€2020-12-09ã«åˆ¥ã®ãƒ–ãƒ­ã‚°åª’ä½“ã«æŠ•ç¨¿ã—ãŸè¨˜äº‹ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã§ã™ã€‚
:::

[Symfony Advent Calendar 2020](https://qiita.com/advent-calendar/2020/symfony) ã®9æ—¥ç›®ã®è¨˜äº‹ã§ã™ï¼ğŸ„ğŸŒ™ å°ãƒã‚¿ã§ã™ã¿ã¾ã›ã‚“ï¼

æ˜¨æ—¥ã¯ [@77web](https://twitter.com/77web) ã•ã‚“ã§ã—ãŸâœ¨

ã¡ãªã¿ã«ã€åƒ•ã¯ã‚ˆã [Twitterã«ã‚‚Symfonyãƒã‚¿ã‚’å‘Ÿã„ã¦ã„ã‚‹](https://twitter.com/search?q=from%3Attskch%20(symfony%20OR%20doctrine)&src=typed_query&f=live) ã®ã§ã€ã‚ˆã‚ã—ã‘ã‚Œã°ãœã² [ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ã‚„ã£ã¦ãã ã•ã„ğŸ•ŠğŸ¤²](https://twitter.com/ttskch)

æœ¬é¡Œã§ã™ã€‚

Doctrineã‚’ä½¿ã†ã¨ä»¥ä¸‹ã®ã‚ˆã†ã« [`@ORM\UniqueConstraint`](https://www.doctrine-project.org/projects/doctrine-orm/en/2.7/reference/annotations-reference.html#annref_uniqueconstraint) ã‚’ä½¿ã£ã¦ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¤‡åˆãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ã‚’ã‹ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã‚ˆã­ã€‚

```php
/**
 * @ORM\Entity(repositoryClass=FooRepository::class)
 * @ORM\Table(uniqueConstraints={
 *     @ORM\UniqueConstraint(name="foo_prop1_prop2_prop3_unique", columns={"prop1", "prop2", "prop3"})
 * })
 */
class Foo
{
    /**
     * @ORM\Column(type="string", length=255)
     */
    public ?string $prop1 = null;

    /**
     * @ORM\Column(type="string", length=255)
     */
    public ?string $prop2 = null;

    /**
     * @ORM\Column(type="string", length=255)
     */
    public ?string $prop3 = null;
    
    // ...
}
```

ã§ã‚‚ã“ã®ã¾ã¾ã ã¨åˆ¶ç´„é•åã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½œã‚ã†ã¨ã—ãŸã¨ãã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ä¾‹å¤–ãŒã‚­ãƒ£ãƒƒãƒã•ã‚Œãªã„ã®ã§ã€æ™®é€šã¯ [`@UniqueEntity`](https://symfony.com/doc/current/reference/constraints/UniqueEntity.html) ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã™ã‚‹ã¨æ€ã„ã¾ã™ã€‚

```php
/**
 * @ORM\Entity(repositoryClass=FooRepository::class)
 * @ORM\Table(uniqueConstraints={
 *     @ORM\UniqueConstraint(name="foo_prop1_prop2_prop3_unique", columns={"prop1", "prop2", "prop3"})
 * })
 * @UniqueEntity(fields={"prop1", "prop2", "prop3"}, message="prop1, prop2, prop3ãŒã™ã¹ã¦åŒä¸€ã®Fooã‚’è¤‡æ•°ä½œæˆã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“", errorPath="prop1")
 */
class Foo
{
```

ã“ã‚Œã§ã€ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ã¯ãªã‚Šã¾ã™ãŒã€ã“ã‚Œã ã¨ `prop1` ã®ãƒ•ã‚©ãƒ¼ãƒ é …ç›®ã«ã—ã‹ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œãªãã¦ã€ã¡ã‚‡ã£ã¨UIçš„ã«è¦ªåˆ‡ã˜ã‚ƒãªã„ã§ã™ã‚ˆã­ã€‚

ã§ãã‚Œã° `prop1` `prop2` `prop3` ã™ã¹ã¦ã«åŒã˜ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ãŸã„ãªãƒ¼ã¨æ€ã†ã¨æ€ã†ã‚“ã§ã™ãŒã€å®Ÿã¯ã‚ã£ã¡ã‚ƒç°¡å˜ã«å¯¾å¿œã§ãã¾ã™ã€‚

```php
/**
 * @ORM\Entity(repositoryClass=FooRepository::class)
 * @ORM\Table(uniqueConstraints={
 *     @ORM\UniqueConstraint(name="foo_prop1_prop2_prop3_unique", columns={"prop1", "prop2", "prop3"})
 * })
 * @UniqueEntity(fields={"prop1", "prop2", "prop3"}, message="prop1, prop2, prop3ãŒã™ã¹ã¦åŒä¸€ã®Fooã‚’è¤‡æ•°ä½œæˆã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“", errorPath="prop1")
 * @UniqueEntity(fields={"prop1", "prop2", "prop3"}, message="prop1, prop2, prop3ãŒã™ã¹ã¦åŒä¸€ã®Fooã‚’è¤‡æ•°ä½œæˆã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“", errorPath="prop2")
 * @UniqueEntity(fields={"prop1", "prop2", "prop3"}, message="prop1, prop2, prop3ãŒã™ã¹ã¦åŒä¸€ã®Fooã‚’è¤‡æ•°ä½œæˆã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“", errorPath="prop3")
 */
class Foo
{
```

ã‚·ãƒ³ãƒ—ãƒ«ã«ã€ã“ã‚Œã§OKã§ã™ã€‚ `errorPath` ã‚’å¤‰ãˆã¦3è¡Œæ›¸ãã ã‘ã€‚

æ„å¤–ã¨ç›²ç‚¹ã˜ã‚ƒãªã„ã§ã™ã‹ï¼Ÿï¼ˆåƒ•ã¯æœ€åˆã‚„ã‚Šæ–¹åˆ†ã‹ã‚‰ãªãã¦å›°ã£ã¦ã¾ã—ãŸï½—ï¼‰

ä»¥ä¸Šã€ã©ã“ã‹ã®èª°ã‹ã®ãŠå½¹ã«ç«‹ã¦ã°å¹¸ã„ã§ã™ï¼

[Symfony Advent Calendar 2020](https://qiita.com/advent-calendar/2020/symfony)ã€æ˜æ—¥ã¯ã¾ãŸåƒ•ã§ã™ï¼ç¬‘ ãŠæ¥½ã—ã¿ã«ï¼
