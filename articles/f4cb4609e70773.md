---
title: "[Symfony] EasyAdminBundleãŒjson DBAL Typeã®é…åˆ—ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å‡ºåŠ›ã—ã¦ãã‚Œãªã„å•é¡Œ"
emoji: "ğŸ»"
type: "tech"
topics: ["php", "symfony"]
published: true
published_at: 2020-04-20
---

:::message
ã“ã®è¨˜äº‹ã¯ã€2020-04-20ã«åˆ¥ã®ãƒ–ãƒ­ã‚°åª’ä½“ã«æŠ•ç¨¿ã—ãŸè¨˜äº‹ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã§ã™ã€‚
:::

ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®DBAL Typeã‚’ `json` ã«ã—ã¦ã„ã‚‹ã¨EasyAdminBundleãŒè‡ªå‹•ã§ãã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å‡¦ç†ã—ã¦ãã‚Œãªã„ã“ã¨ã«æ°—ã¥ã„ãŸã®ã§ãƒ¡ãƒ¢ã§ã™ã€‚

# ã©ã†ã„ã†ã“ã¨ï¼Ÿ

EasyAdminBundleã¯ã€å¤šãã®å ´åˆä½•ã‚‚è€ƒãˆãšã«

```yaml
easy_admin:
  entities:
      - App\Entity\Foo
      - App\Entity\Bar
      - App\Entity\Baz
```

ã£ã¦æ„Ÿã˜ã§è¨­å®šã—ã¦ãŠã‘ã°ã€ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’å‹æ‰‹ã«æ¨æ¸¬ã—ã¦é©åˆ‡ã«CRUDã®ç”»é¢ã‚’è¡¨ç¤ºã—ã¦ãã‚Œã¾ã™ã€‚

ãŒã€DBAL TypeãŒ `json` ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ç„¡è¦–ã•ã‚Œã‚‹ä»•æ§˜ã«ãªã£ã¦ã„ã‚‹ãŸã‚ã€é…åˆ—ã‚’å…¥ã‚Œã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ `json` DBAL Typeã§ä½œã£ã¦ã„ã‚‹ã¨ã€ãã®é …ç›®ãŒEasyAdminBundleã®ç®¡ç†ç”»é¢ã«è¡¨ç¤ºã•ã‚Œãªãã¦å›°ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

ä»Šå›ã“ã®å•é¡Œã«æ°—ã¥ã„ãŸã®ã¯ã€[MakerBundle](https://symfony.com/doc/current/bundles/SymfonyMakerBundle/index.html) ã§ä½œã£ãŸUserã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã® `$roles` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒ `json` DBAL Typeã«ãªã£ã¦ã„ãŸãŸã‚ã§ã™ã€‚

```
$ bin/console make:user
```

ã§Userã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ä½œã‚‹ã¨ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ `$roles` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒ `json` DBAL Typeã§ä½œæˆã•ã‚Œã¾ã™ã€‚

```php
/**
 * @ORM\Column(type="json")
 */
private $roles = [];
```

ã“ã®çŠ¶æ…‹ã§EasyAdminBundleã‚’

```yaml
easy_admin:
  entities:
      - App\Entity\User
```

ã¨ã ã‘è¨­å®šã—ã¦ã‚‚ã€ `$roles` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒè¡¨ç¤ºã•ã‚Œãªã„ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

ã¡ãªã¿ã«ã€EasyAdminBundleã® [ã“ã®è¾ºã‚Šã®ã‚³ãƒ¼ãƒ‰](https://github.com/EasyCorp/EasyAdminBundle/blob/794bb8b7e554427f408e1a3a728c072b29a53307/src/Configuration/ViewConfigPass.php#L272-L274) ã§ `json` ã‚‚ `json_array` ã‚‚é™¤å¤–ã•ã‚Œã¦ã„ã‚‹ã£ã½ã„ã§ã™ã€‚

> [`json` DBAL Typeã¯Doctrineçš„ã«ã¯é…åˆ—ãªã®ã§](https://www.doctrine-project.org/projects/doctrine-dbal/en/2.10/reference/types.html#json) æ™®é€šã«é…åˆ—ã¨ã—ã¦æ‰±ã£ã¦ãã‚Œã¦ã‚‚ã‚ˆã•ãã†ãªã‚“ã§ã™ãŒâ€¦ğŸ¤”

# è§£æ±ºç­–1

ã¨ã‚‚ã‹ãã€ `json` DBAL Typeã§ã¯ãªã `array` DBAL Typeã‚’ä½¿ãˆã°ã™ãã«è§£æ±ºã§ãã¾ã™ã€‚

```diff
/**
- * @ORM\Column(type="json")
+ * @ORM\Column(type="array")
 */
private $roles = [];
```

```bash
$ bin/console doctrine:migrations:diff
```

```bash
$ bin/console doctrine:migrations:migrate
```

ã‚‚ã—ã™ã§ã«jsonå‹å¼ã®ãƒ‡ãƒ¼ã‚¿ãŒå…¥ã£ã¦ã„ã‚‹å ´åˆã¯ã€ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚«ãƒ©ãƒ ã®å‹ã ã‘ã‚’å¤‰æ›´ã—ã¦ã‚‚ã€ä¸­ã«å…¥ã£ã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒjsonå‹å¼ã ã¨ã‚¢ãƒ—ãƒªã§unserializeã—ã‚ˆã†ã¨ã—ã¦ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã—ã¾ã†ã®ã§ã€ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°ã®ãŸã‚ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚æ›¸ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

Doctrine Migrationsã§ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ‰‹å‹•ã§æ›¸ãæ–¹æ³•ã«ã¤ã„ã¦ã¯ [ã“ã¡ã‚‰ã®è¨˜äº‹](https://zenn.dev/ttskch/articles/a629dd3b9b8398) ã‚’ã”å‚ç…§ãã ã•ã„ã€‚

# è§£æ±ºç­–2

ã©ã†ã—ã¦ã‚‚ `json` DBAL Typeã®ã¾ã¾ã§è¡ŒããŸã„å ´åˆã¯ã€EasyAdminBundleã‚’ã€ŒãŠä»»ã›ã€ã§ä½¿ã†ã®ã§ã¯ãªãã€è‡ªåˆ†ã§ç´°ã‹ãè¨­å®šã—ã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```yaml
easy_admin:
  entities:
    User:
      class: App\Entity\User
      list:
        fields:
          - { property: email, type: email }
          - { property: roles, type: array }
      form:
        fields:
          - { property: email, type: email }
          - { property: password, type: text }
          - { property: roles, type: collection }
```

ã“ã‚“ãªæ„Ÿã˜ã§ã€ä¸€è¦§ç”»é¢ã¨ä½œæˆãƒ»ç·¨é›†ç”»é¢ãã‚Œãã‚Œã«ã¤ã„ã¦ã€ã©ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ã©ã®ã‚¿ã‚¤ãƒ—ã§å‡ºåŠ›ã™ã‚‹ã‹ã‚’å…¨éƒ¨è¨­å®šã—ã¦ã‚ã’ã‚Œã°OKã§ã™ã€‚

![](https://tva1.sinaimg.cn/large/007S8ZIlgy1gdyu58969lj31w20bgt9t.jpg)

![](https://tva1.sinaimg.cn/large/007S8ZIlgy1gdyu60m0f7j31vw0mi0uo.jpg)

# ã¾ã¨ã‚

* EasyAdminBundleã¯ã€ `json` DBAL Typeã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è‡ªå‹•ã§è¡¨ç¤ºã—ã¦ãã‚Œãªã„
* DBAL Typeã‚’ `array` ã«å¤‰æ›´ã™ã‚‹ã‹ã€easy_admin.yamlã‚’ç´°ã‹ãè¨­å®šã—ã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚‹
