---
title: "Symfonyã§ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’Timestampableã«ã§ãã‚‹Doctrine extensionsã«ä¾¿åˆ©ãªTraitãŒã‚ã£ãŸä»¶"
emoji: "ğŸ»"
type: "tech"
topics: ["php", "symfony"]
published: true
published_at: 2020-04-17
---

:::message
ã“ã®è¨˜äº‹ã¯ã€2020-04-17ã«åˆ¥ã®ãƒ–ãƒ­ã‚°åª’ä½“ã«æŠ•ç¨¿ã—ãŸè¨˜äº‹ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã§ã™ã€‚
:::

ã‚¿ã‚¤ãƒˆãƒ«ã®ã¨ãŠã‚Šãªã®ã§ã™ãŒè£œè¶³ã‚‚å«ã‚ã¦é•·ã€…ã¨æ›¸ãã¾ã™ã€‚çµè«–ã¯ [ã“ã¡ã‚‰](#å®Ÿã¯ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨getter%2Fsetterã‚’è¿½åŠ ã—ã¦ãã‚Œã‚‹traitãŒã‚ã£ãŸ)ã€‚

# Doctrine extensionsã¨ã¯

Symfonyã§ã€ã™ã¹ã¦ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«ä½œæˆæ—¥æ™‚ã¨æ›´æ–°æ—¥æ™‚ã‚’æŒãŸã›ãŸã„ã¨ã„ã†è¦ä»¶ã¯ã‚ˆãã‚ã‚Šã¾ã™ã€‚

ã€Œä½œæˆæ—¥æ™‚ã¨æ›´æ–°æ—¥æ™‚ã‚’æŒã¤ã€ã¨ã„ã†æŒ¯ã‚‹èˆã„ã®ã“ã¨ã‚’è‹±èªã§ã¯ `Timestampable` ã¨è¨€ã£ãŸã‚Šã—ã¾ã™ã€‚

`symfony timestampable` ã¨ã‹ã§ã‚°ã‚°ã£ã¦ã¿ã‚‹ã¨ã€[Doctrine extensions](https://github.com/Atlantic18/DoctrineExtensions) ã® `Timestampable` ã‚’ä½¿ã„ã¾ã—ã‚‡ã†ã¨ã„ã†æƒ…å ±ãŒå‡ºã¦ãã¾ã™ã€‚

> Symfonyã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚Doctrine extensionsã«ãƒªãƒ³ã‚¯ã—ã¦ã„ã¾ã™ã­ã€‚
> <https://symfony.com/doc/current/doctrine.html#doctrine-extensions-timestampable-translatable-etc>

Doctrine extensionsã¯ã€Doctrine ORMï¼ˆãŠã‚ˆã³MongoDM ODMï¼‰ã«å¯¾ã—ã¦ä¾¿åˆ©ãªæ‹¡å¼µã‚’è‰²ã€…ã¨æä¾›ã—ã¦ãã‚Œã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚

![](https://tva1.sinaimg.cn/large/007S8ZIlgy1gdwsjcbhzcj31c50u0k0c.jpg)

ã“ã®ä¸­ã®ä¸€ã¤ã§ã‚ã‚‹ `Timestampable` ã‚’ä½¿ãˆã°ç°¡å˜ã«ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’Timestampableã«ã§ãã‚‹ã‚ˆã¨ã„ã†ã“ã¨ã§ã™ã€‚

# å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã¨ãŠã‚Šå°å…¥ã—ã¦ã¿ã‚‹

[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://github.com/Atlantic18/DoctrineExtensions/blob/v2.4.x/doc/symfony4.md) ã«ã‚ˆã‚‹ã¨ã€gedmo/doctrine-extensions ã® `Timestampable` æ©Ÿèƒ½ã‚’Symfony4ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å°å…¥ã™ã‚‹æ‰‹é †ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã¨ã®ã“ã¨ã§ã™ã€‚

**1. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹**

```
composer require gedmo/doctrine-extensions
```

**2. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚‹**

```yaml
services:
  gedmo.listener.timestampable:
    class: Gedmo\Timestampable\TimestampableListener
    tags:
      - { name: doctrine.event_subscriber, connection: default }
    calls:
      - [setAnnotationReader, ['@annotation_reader']]
```

**3. ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚¯ãƒ©ã‚¹ã«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨getter/setterã‚’è¿½åŠ ã—ã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã¯ `@Gedmo\Timestampable()` ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ã‚‹**

```php
/**
 * @ORM\Column(type="datetime")
 *
 * @Gedmo\Timestampable(on="create")
 *
 * @var \DateTime
 */
private $createdAt;

/**
 * @ORM\Column(type="datetime")
 *
 * @Gedmo\Timestampable(on="update")
 *
 * @var \DateTime
 */
private $updatedAt;

// ...

public function getCreatedAt(): \DateTime
{
    return $this->createdAt;
}

public function setCreatedAt(\DateTime $createdAt): void
{
    $this->createdAt = $createdAt;
}

public function getUpdatedAt(): \DateTime
{
    return $this->updatedAt;
}

public function setUpdatedAt(\DateTime $updatedAt): void
{
    $this->updatedAt = $updatedAt;
}
```

â€¦ãˆã€ã‚ã¡ã‚ƒãã¡ã‚ƒé¢å€’ã˜ã‚ƒãªã„ã§ã™ã‹ï¼ŸğŸ˜“

ç‰¹ã«ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«ã„ã¡ã„ã¡ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨getter/setterã‚’è‡ªåˆ†ã§æ›¸ã‹ãªã„ã¨ã„ã‘ãªã„ã®ãŒã™ã”ãå«Œã§ã™ã€‚é©å½“ã«ã‚ˆã‚ã—ãã‚„ã£ã¦ã»ã—ã„â€¦

# å®Ÿã¯ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨getter/setterã‚’è¿½åŠ ã—ã¦ãã‚Œã‚‹TraitãŒã‚ã£ãŸ

ãªã‚“ã¨ã€ã‚ˆãè¦‹ãŸã‚‰ [TimestampableEntity](https://github.com/Atlantic18/DoctrineExtensions/blob/e5abbb87e429ccc8747d3c0722db2d88e8dd8998/lib/Gedmo/Timestampable/Traits/TimestampableEntity.php) ã¨ã‹ã„ã†ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨getter/setterã‚’è¿½åŠ ã—ã¦ãã‚Œã‚‹TraitãŒã‚ã‚Šã¾ã—ãŸğŸ˜“

[Install Gedmo Doctrine2 extensions in Symfony 4](https://github.com/Atlantic18/DoctrineExtensions/blob/v2.4.x/doc/symfony4.md)

ã“ã£ã¡ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒTraitã«ä¸€åˆ‡è§¦ã‚Œã¦ãªã‹ã£ãŸã®ã§ã¾ã£ãŸãæ°—ä»˜ã‹ãªã‹ã£ãŸã®ã§ã™ãŒã€

[Timestampable behavior extension for Doctrine 2](https://github.com/Atlantic18/DoctrineExtensions/blob/v2.4.x/doc/timestampable.md)

ã“ã£ã¡ã®Timestampableå˜ä½“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¦‹ã‚‹ã¨ã€[æœ€å¾Œã«ã¡ã‚ƒã‚“ã¨Traitã«ã¤ã„ã¦æ›¸ã‹ã‚Œã¦ã¾ã—ãŸã€‚](https://github.com/Atlantic18/DoctrineExtensions/blob/v2.4.x/doc/timestampable.md#traits)

çŸ¥ã£ã¦ã¾ã—ãŸã‹ï¼ŸçŸ¥ã£ã¦ã¾ã—ãŸã‹ã€‚ãã†ã§ã™ã‹â€¦ã€‚

ä½•ã«ã›ã‚ˆã€ã“ã®Traitã‚’ä½¿ãˆã°ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®å¤‰æ›´ã¯

```php
use Gedmo\Timestampable\Traits\TimestampableEntity;

// ...

use TimestampableEntity;
```

ã®2è¡Œã ã‘ã§ã„ã„ã®ã§ã€ã ã„ã¶å¹¸ã›ã«ãªã‚Œã¾ã™ã€‚

# ä½™è«‡ï¼šTraitã®å­˜åœ¨ã‚’çŸ¥ã‚‰ãªã‹ã£ãŸã®ã§ãšã£ã¨ä»£ã‚ã‚Šã«knplabs/doctrine-behaviorsã‚’ä½¿ã£ã¦ã¾ã—ãŸ

ã¡ãªã¿ã«ã€åƒ•ã¯ã‚¢ãƒ›ã™ãã¦Traitã®å­˜åœ¨ã«æ°—ã¥ã„ã¦ãªã‹ã£ãŸã®ã§ã€ãšã£ã¨ä»£ã‚ã‚Šã« [knplabs/doctrine-behaviors](https://github.com/KnpLabs/DoctrineBehaviors) ã‚’ä½¿ã£ã¦ã¾ã—ãŸã€‚

ã“ã£ã¡ã¯ã‚¢ãƒ›ãªåƒ•ã§ã‚‚ [ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://github.com/KnpLabs/DoctrineBehaviors/blob/ebb188c6c29b09ede700e90f31201f6cefa2ab5b/docs/timestampable.md) ã‚’è¦‹ã‚Œã°

* `TimestampableInterface` ã‚’å®Ÿè£…ã—ã¦
* `TimestampableTrait` ã‚’useã™ã‚Œã°

ãã‚Œã ã‘ã§Timestampableã«ãªã‚‹ã‚„ã‚“ï¼ã¨ã„ã†ã“ã¨ãŒä¸€ç›®ã§åˆ†ã‹ã£ãŸã®ã§ã€æœ‰é›£ãŒã£ã¦ä½¿ã£ã¦ã¾ã—ãŸğŸ˜…

ã¾ã‚ã§ã‚‚ã“ã¡ã‚‰ã¯Doctrine extensionsã¨é•ã£ã¦è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒä¸è¦ã§ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’è¿½è¨˜ã™ã‚‹ã ã‘ã§å¯¾å¿œã§ãã‚‹ã®ã§ã€ã¡ã‚‡ã£ã¨ã§ã‚‚æ¥½ã—ãŸã„äººã«ã¯ã„ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

# ã¾ã¨ã‚

* Doctrine extensionsã®Timestampableã«ã¯ä¾¿åˆ©ãªTraitãŒã‚ã£ãŸ
* ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã¡ã‚ƒã‚“ã¨éš…ã€…ã¾ã§èª­ã‚‚ã†â€¦
* knplabs/doctrine-behaviorsã‚‚ä¾¿åˆ©ã ã‚ˆ
